<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MENTECH â€” Just Fix It.</title>
<link href="https://fonts.googleapis.com/css2?family=Anton&family=Barlow+Condensed:wght@400;600;700;900&family=Barlow:wght@400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   BASE - Version ULTIME
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root{
  --red:#E31837; --black:#080808; --white:#fff;
  --gray:#777; --card:#111; --border:#1c1c1c; --border2:#2a2a2a;
  --green:#22c55e; --yellow:#f59e0b; --blue:#3b82f6; --purple:#a855f7;
}
*{margin:0;padding:0;box-sizing:border-box;}
html{scroll-behavior:smooth;}
body{font-family:'Barlow',sans-serif;background:var(--black);color:var(--white);overflow-x:hidden;cursor:none;}
::-webkit-scrollbar{width:4px;}::-webkit-scrollbar-track{background:#080808;}::-webkit-scrollbar-thumb{background:var(--red);}
#cursor{width:9px;height:9px;background:var(--red);border-radius:50%;position:fixed;pointer-events:none;z-index:9999;transform:translate(-50%,-50%);transition:width .18s,height .18s;mix-blend-mode:difference;}
#cursor.big{width:34px;height:34px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHARED COMPONENTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.eyebrow{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:12px;letter-spacing:.15em;text-transform:uppercase;color:var(--red);margin-bottom:8px;}
.btn-r{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:12px;letter-spacing:.08em;text-transform:uppercase;background:var(--red);color:var(--white);border:none;cursor:pointer;padding:10px 22px;transition:background .2s,transform .15s;}
.btn-r:hover{background:#c01028;transform:scale(1.03);}
.btn-o{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:12px;letter-spacing:.08em;text-transform:uppercase;background:transparent;color:var(--gray);border:1px solid var(--border2);cursor:pointer;padding:10px 20px;transition:border-color .2s,color .2s;}
.btn-o:hover{border-color:var(--white);color:var(--white);}
.btn-g{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:13px;letter-spacing:.08em;text-transform:uppercase;background:var(--green);color:var(--white);border:none;cursor:pointer;padding:12px 28px;transition:background .2s,transform .15s;display:inline-flex;align-items:center;gap:8px;}
.btn-g:hover{background:#16a34a;transform:scale(1.03);}
.btn-danger{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:13px;letter-spacing:.08em;text-transform:uppercase;background:transparent;color:#ef4444;border:1px solid #ef4444;cursor:pointer;padding:12px 28px;transition:background .2s,color .2s;display:inline-flex;align-items:center;gap:8px;}
.btn-danger:hover{background:#ef4444;color:var(--white);}
@keyframes fiu{from{opacity:0;transform:translateY(16px);}to{opacity:1;transform:translateY(0);}}
@keyframes pd{0%,100%{box-shadow:0 0 0 0 rgba(227,24,55,.5);}50%{box-shadow:0 0 0 6px transparent;}}
@keyframes pop{from{transform:scale(0);}to{transform:scale(1);}}
@keyframes spin{to{transform:rotate(360deg);}}
@keyframes pulse-ring{0%{transform:scale(.9);opacity:1;}100%{transform:scale(1.5);opacity:0;}}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   LOGIN GATE - Version DOUBLE RÃ”LE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#login-gate{position:fixed;inset:0;z-index:600;background:var(--black);display:flex;align-items:center;justify-content:center;padding:20px;transition:opacity .4s;}
.login-box{width:100%;max-width:430px;border:1px solid var(--border2);background:#0d0d0d;}
.login-logo{padding:28px 32px 0;font-family:'Anton',sans-serif;font-size:20px;letter-spacing:-.02em;}
.login-logo span{color:var(--red);}
.login-head{padding:20px 32px 0;}
.login-head h2{font-family:'Anton',sans-serif;font-size:34px;letter-spacing:-.02em;line-height:.95;margin-bottom:5px;}
.login-head p{font-family:'Barlow Condensed',sans-serif;font-size:14px;color:var(--gray);}
.login-body{padding:24px 32px 28px;}
.login-lbl{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:11px;letter-spacing:.14em;text-transform:uppercase;color:var(--gray);display:block;margin-bottom:7px;}
.login-inp{width:100%;background:var(--black);border:1px solid var(--border2);color:var(--white);padding:13px 15px;font-size:16px;font-family:'Barlow',sans-serif;outline:none;transition:border-color .2s;margin-bottom:5px;}
.login-inp:focus{border-color:var(--red);}
.login-err{font-size:12px;color:var(--red);font-family:'Barlow Condensed',sans-serif;font-weight:600;letter-spacing:.04em;min-height:18px;margin-bottom:12px;}

/* Double rÃ´le switcher */
.role-switch{display:flex;gap:0;margin-bottom:25px;border:1px solid var(--border2);}
.role-opt{flex:1;text-align:center;padding:12px;font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:12px;letter-spacing:.1em;text-transform:uppercase;cursor:pointer;transition:all .2s;background:var(--black);color:var(--gray);}
.role-opt.active{background:var(--red);color:var(--white);}
.role-opt:first-child{border-right:1px solid var(--border2);}

.login-btn{width:100%;font-family:'Anton',sans-serif;font-size:17px;letter-spacing:.03em;background:var(--red);color:var(--white);border:none;cursor:pointer;padding:15px;display:flex;align-items:center;justify-content:center;gap:10px;transition:background .2s;margin-bottom:15px;}
.login-btn:hover{background:#c01028;}

/* Tech login fields (hidden by default) */
#tech-login-fields{display:none;margin-bottom:15px;}
.tech-login-note{padding:12px;background:rgba(227,24,55,.08);border:1px solid rgba(227,24,55,.25);font-family:'Barlow Condensed',sans-serif;font-size:13px;color:var(--gray);margin-bottom:15px;}
.tech-login-note strong{color:var(--red);}

.login-disc{border-top:1px solid var(--border);padding:12px 32px;font-size:11px;color:#444;font-family:'Barlow Condensed',sans-serif;letter-spacing:.04em;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   NAVBAR
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
nav{position:fixed;top:0;left:0;right:0;z-index:100;height:60px;display:flex;align-items:center;justify-content:space-between;padding:0 32px;background:var(--black);border-bottom:1px solid var(--border);}
.logo{font-family:'Anton',sans-serif;font-size:19px;letter-spacing:-.02em;cursor:pointer;}
.logo span{color:var(--red);}
.nav-links{display:flex;gap:24px;}
.nav-link{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:12px;letter-spacing:.1em;text-transform:uppercase;color:var(--gray);cursor:pointer;transition:color .2s;}
.nav-link:hover{color:var(--white);}
.nav-right{display:flex;align-items:center;gap:10px;}
#loc-pill{display:flex;align-items:center;gap:6px;font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:11px;color:var(--gray);padding:7px 13px;border:1px solid var(--border);cursor:pointer;transition:border-color .2s;}
#loc-pill i{color:var(--red);font-size:10px;}
#loc-pill:hover{border-color:var(--red);}
.user-badge{display:flex;align-items:center;gap:7px;font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:12px;color:var(--white);padding:7px 13px;border:1px solid var(--border2);background:var(--card);}
.user-badge i{color:var(--red);font-size:10px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TECH PANEL - Notifications et missions
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.tech-notif-badge{position:relative;margin-left:10px;}
.tech-notif-dot{position:absolute;top:-2px;right:-2px;width:10px;height:10px;border-radius:50%;background:var(--red);box-shadow:0 0 8px var(--red);display:none;}
.tech-notif-dot.active{display:block;}

/* Setup CallMeBot */
.setup-box{background:#0d0d0d;border:1px solid rgba(37,211,102,.2);padding:20px;max-width:560px;margin-bottom:24px;}
.setup-box h4{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:13px;letter-spacing:.08em;text-transform:uppercase;color:var(--green);margin-bottom:10px;display:flex;align-items:center;gap:7px;}
.setup-box p{font-size:13px;color:var(--gray);line-height:1.55;margin-bottom:10px;}
.setup-box code{font-family:monospace;font-size:12px;background:rgba(255,255,255,.06);padding:2px 7px;border-radius:3px;color:var(--white);}
.setup-inp{width:100%;background:var(--black);border:1px solid var(--border2);color:var(--white);padding:10px 13px;font-size:14px;font-family:'Barlow',sans-serif;outline:none;transition:border-color .2s;margin-top:8px;}
.setup-inp:focus{border-color:var(--green);}
.btn-save-key{margin-top:8px;font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:12px;letter-spacing:.07em;text-transform:uppercase;background:rgba(37,211,102,.15);color:var(--green);border:1px solid rgba(37,211,102,.3);cursor:pointer;padding:9px 18px;transition:background .2s;}
.btn-save-key:hover{background:rgba(37,211,102,.25);}
.key-saved{font-size:11px;color:var(--green);font-family:'Barlow Condensed',sans-serif;font-weight:600;margin-top:6px;display:none;}

/* Mission cards */
.mission-card{background:#0d0d0d;border:1px solid var(--border2);max-width:560px;margin-bottom:16px;}
.mc-header{padding:14px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
.mc-order{font-family:'Anton',sans-serif;font-size:14px;letter-spacing:.06em;color:var(--red);}
.mc-time{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:11px;color:var(--gray);letter-spacing:.05em;}
.mc-client{display:flex;align-items:center;gap:12px;padding:16px 20px;border-bottom:1px solid var(--border);background:var(--black);}
.mc-client-icon{width:40px;height:40px;border-radius:50%;background:rgba(227,24,55,.12);display:flex;align-items:center;justify-content:center;color:var(--red);font-size:16px;}
.mc-client-nm{font-family:'Barlow Condensed',sans-serif;font-weight:900;font-size:16px;}
.mc-client-ph{font-size:12px;color:var(--gray);}
.mc-rows{}
.mc-row{display:flex;justify-content:space-between;align-items:flex-start;padding:10px 20px;border-bottom:1px solid var(--border);}
.mc-row:last-child{border-bottom:none;}
.mc-k{color:var(--gray);font-family:'Barlow Condensed',sans-serif;font-weight:600;font-size:12px;letter-spacing:.05em;text-transform:uppercase;}
.mc-v{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:13px;text-align:right;max-width:280px;}
.mc-price{font-family:'Anton',sans-serif;font-size:20px;color:var(--green);}
.mc-actions{display:flex;gap:10px;padding:16px 20px;border-top:1px solid var(--border);flex-wrap:wrap;}
.mc-done{padding:12px 20px;background:rgba(34,197,94,.08);border:1px solid rgba(34,197,94,.25);font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:13px;color:var(--green);letter-spacing:.04em;display:flex;align-items:center;gap:8px;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   RECRUTEMENT - Formulaire CV
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.recrutement-section{padding:40px 20px;max-width:800px;margin:0 auto;}
.recrutement-header{text-align:center;margin-bottom:40px;}
.recrutement-header h1{font-family:'Anton',sans-serif;font-size:48px;letter-spacing:-.02em;margin-bottom:10px;}
.recrutement-header h1 span{color:var(--red);}
.recrutement-header p{font-family:'Barlow Condensed',sans-serif;font-size:16px;color:var(--gray);}
.recrutement-form{background:#0d0d0d;border:1px solid var(--border2);padding:30px;}
.form-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:15px;}
.form-group{margin-bottom:15px;}
.form-group.full{grid-column:span 2;}
.form-label{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:12px;letter-spacing:.1em;text-transform:uppercase;color:var(--gray);display:block;margin-bottom:5px;}
.form-input{width:100%;background:var(--black);border:1px solid var(--border2);color:var(--white);padding:12px 15px;font-size:14px;font-family:'Barlow',sans-serif;outline:none;transition:border-color .2s;}
.form-input:focus{border-color:var(--red);}
.form-select{width:100%;background:var(--black);border:1px solid var(--border2);color:var(--white);padding:12px 15px;font-size:14px;font-family:'Barlow',sans-serif;outline:none;cursor:pointer;}
.form-file{padding:10px;background:var(--black);border:1px dashed var(--border2);text-align:center;cursor:pointer;}
.form-file:hover{border-color:var(--red);}
.upload-note{font-size:11px;color:var(--gray);margin-top:5px;}
.btn-submit-cv{width:100%;font-family:'Anton',sans-serif;font-size:16px;background:var(--red);color:var(--white);border:none;cursor:pointer;padding:15px;margin-top:20px;transition:background .2s;}
.btn-submit-cv:hover{background:#c01028;}
.success-message{padding:20px;background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.3);color:var(--green);text-align:center;font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:15px;margin-bottom:20px;display:none;}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VIEWS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.view{display:none;min-height:100vh;padding-top:60px;}
.view.active{display:block;}
.view-flex{display:none;min-height:100vh;padding-top:60px;align-items:center;justify-content:center;flex-direction:column;text-align:center;padding-left:20px;padding-right:20px;}
.view-flex.active{display:flex;}

/* HOME */
.hero{position:relative;min-height:88vh;display:flex;flex-direction:column;justify-content:center;padding:76px 32px 56px;overflow:hidden;}
.hero-grid{position:absolute;inset:0;background-image:linear-gradient(var(--border) 1px,transparent 1px),linear-gradient(90deg,var(--border) 1px,transparent 1px);background-size:60px 60px;opacity:.4;}
.hero-glow{position:absolute;width:700px;height:700px;border-radius:50%;background:radial-gradient(circle,rgba(227,24,55,.1),transparent 65%);top:-100px;right:-120px;pointer-events:none;}
.badge-pill{display:inline-flex;align-items:center;gap:8px;font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:12px;letter-spacing:.14em;text-transform:uppercase;color:var(--red);border:1px solid rgba(227,24,55,.3);padding:6px 13px;margin-bottom:20px;animation:fiu .6s ease both;}
.pulse-dot{width:6px;height:6px;border-radius:50%;background:var(--red);flex-shrink:0;animation:pd 2s infinite;}
.hero h1{font-family:'Anton',sans-serif;font-size:clamp(62px,11vw,144px);line-height:.88;letter-spacing:-.03em;margin-bottom:22px;animation:fiu .7s .1s ease both;}
.hero h1 em{color:var(--red);font-style:normal;}
.hero-sub{font-family:'Barlow Condensed',sans-serif;font-size:17px;color:var(--gray);max-width:420px;line-height:1.55;margin-bottom:30px;animation:fiu .7s .2s ease both;}
.hero-btns{display:flex;gap:10px;flex-wrap:wrap;animation:fiu .7s .3s ease both;}
.hero-cta{font-family:'Anton',sans-serif;font-size:16px;letter-spacing:.02em;background:var(--red);color:var(--white);border:none;cursor:pointer;padding:15px 32px;display:flex;align-items:center;gap:10px;transition:transform .2s,background .2s;}
.hero-cta:hover{transform:translateX(4px);background:#c01028;}
.hero-ghost{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:13px;letter-spacing:.07em;text-transform:uppercase;background:transparent;color:var(--gray);border:1px solid var(--border2);cursor:pointer;padding:15px 24px;transition:color .2s,border-color .2s;}
.hero-ghost:hover{color:var(--white);border-color:var(--white);}
.ticker{border-top:1px solid var(--border);border-bottom:1px solid var(--border);overflow:hidden;white-space:nowrap;padding:10px 0;}
.ticker-track{display:inline-flex;gap:32px;animation:tick 28s linear infinite;}
.tick-item{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:12px;letter-spacing:.1em;text-transform:uppercase;color:var(--gray);display:inline-flex;align-items:center;gap:8px;}
.tick-dot{width:4px;height:4px;border-radius:50%;background:var(--red);flex-shrink:0;}
@keyframes tick{from{transform:translateX(0);}to{transform:translateX(-50%);}}
.stats-row{display:grid;grid-template-columns:repeat(4,1fr);border-top:1px solid var(--border);}
.stat-cell{padding:32px 26px;border-right:1px solid var(--border);}
.stat-cell:last-child{border-right:none;}
.stat-n{font-family:'Anton',sans-serif;font-size:44px;letter-spacing:-.02em;}
.stat-n em{color:var(--red);font-style:normal;}
.stat-l{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:11px;letter-spacing:.12em;text-transform:uppercase;color:var(--gray);margin-top:4px;}
.sec-header{padding:48px 32px 22px;display:flex;align-items:flex-end;justify-content:space-between;flex-wrap:wrap;gap:12px;}
.sec-title{font-family:'Anton',sans-serif;font-size:clamp(30px,5vw,54px);letter-spacing:-.02em;line-height:.95;}
.sec-action{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:12px;letter-spacing:.07em;text-transform:uppercase;color:var(--gray);cursor:pointer;display:flex;align-items:center;gap:5px;transition:color .2s;}
.sec-action:hover{color:var(--white);}
.svc-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:1px;background:var(--border);border-top:1px solid var(--border);}
.svc-tile{background:var(--black);padding:28px 24px;cursor:pointer;position:relative;overflow:hidden;transition:background .2s;display:flex;flex-direction:column;gap:12px;}
.svc-tile::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--a,var(--red));transform:scaleY(0);transform-origin:bottom;transition:transform .28s ease;}
.svc-tile:hover{background:#0f0f0f;}
.svc-tile:hover::before{transform:scaleY(1);}
.svc-tile:hover .t-arr{transform:translateX(5px);}
.t-icon{width:44px;height:44px;border-radius:4px;display:flex;align-items:center;justify-content:center;font-size:18px;background:var(--ab);color:var(--a,var(--red));}
.t-name{font-family:'Anton',sans-serif;font-size:20px;letter-spacing:-.01em;}
.t-desc{font-size:12px;color:var(--gray);line-height:1.45;flex:1;}
.t-foot{display:flex;align-items:center;justify-content:space-between;border-top:1px solid var(--border);padding-top:12px;}
.t-count{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:11px;letter-spacing:.07em;text-transform:uppercase;color:var(--gray);}
.t-arr{font-size:12px;color:var(--a,var(--red));transition:transform .2s;}
.join-banner{padding:60px 32px;background:var(--red);display:flex;align-items:center;justify-content:space-between;gap:24px;flex-wrap:wrap;}
.join-h{font-family:'Anton',sans-serif;font-size:clamp(24px,4vw,48px);letter-spacing:-.02em;line-height:1;margin-bottom:8px;}
.join-p{font-family:'Barlow Condensed',sans-serif;font-size:14px;opacity:.88;}
.btn-w{font-family:'Anton',sans-serif;font-size:14px;background:var(--white);color:var(--red);border:none;cursor:pointer;padding:14px 28px;transition:transform .2s,background .2s;white-space:nowrap;}
.btn-w:hover{background:#f0f0f0;transform:scale(1.03);}

/* Footer */
footer{border-top:1px solid var(--border);padding:40px 32px;display:flex;flex-wrap:wrap;gap:28px;justify-content:space-between;}
.f-logo{font-family:'Anton',sans-serif;font-size:22px;margin-bottom:5px;}
.f-logo span{color:var(--red);}
.f-tag{font-size:11px;color:var(--gray);font-family:'Barlow Condensed',sans-serif;font-weight:600;letter-spacing:.06em;}
.f-col h4{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:11px;letter-spacing:.14em;text-transform:uppercase;color:var(--gray);margin-bottom:12px;}
.f-col a{display:block;font-size:12px;color:var(--gray);text-decoration:none;margin-bottom:8px;transition:color .2s;}
.f-col a:hover{color:var(--white);}
.f-bottom{border-top:1px solid var(--border);padding:13px 32px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px;}
.f-copy{font-size:11px;color:#444;font-family:'Barlow Condensed',sans-serif;letter-spacing:.05em;}

/* Breadcrumb */
.breadcrumb{padding:16px 32px 0;display:flex;align-items:center;gap:7px;font-family:'Barlow Condensed',sans-serif;font-size:12px;font-weight:700;letter-spacing:.07em;text-transform:uppercase;color:var(--gray);}
.breadcrumb a{color:var(--gray);cursor:pointer;transition:color .2s;}
.breadcrumb a:hover{color:var(--white);}
.breadcrumb .sep{color:var(--border2);}
.breadcrumb .cur{color:var(--white);}

/* Problems View */
.prob-hero{padding:28px 32px 22px;border-bottom:1px solid var(--border);}
.svc-tag-lbl{display:inline-flex;align-items:center;gap:8px;font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:12px;letter-spacing:.1em;text-transform:uppercase;padding:5px 12px;border:1px solid var(--border2);margin-bottom:12px;color:var(--gray);}
.prob-hero h1{font-family:'Anton',sans-serif;font-size:clamp(32px,6vw,68px);letter-spacing:-.02em;line-height:.9;margin-bottom:8px;}
.prob-hero p{font-family:'Barlow Condensed',sans-serif;font-size:14px;color:var(--gray);}
.prob-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:1px;background:var(--border);border-top:1px solid var(--border);}
.prob-tile{background:var(--black);padding:20px 24px;cursor:pointer;display:flex;align-items:center;justify-content:space-between;gap:10px;transition:background .2s;position:relative;overflow:hidden;}
.prob-tile::after{content:'';position:absolute;bottom:0;left:0;right:0;height:2px;background:var(--red);transform:scaleX(0);transform-origin:left;transition:transform .26s ease;}
.prob-tile:hover{background:#0f0f0f;}
.prob-tile:hover::after{transform:scaleX(1);}
.prob-tile:hover .p-arr{transform:translateX(5px);}
.p-name{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:15px;letter-spacing:.02em;}
.p-arr{font-size:12px;color:var(--red);transition:transform .2s;flex-shrink:0;}

/* Results View */
.res-header{padding:24px 32px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px;}
.res-meta{font-family:'Barlow Condensed',sans-serif;font-size:14px;color:var(--gray);}
.res-meta strong{color:var(--white);font-weight:900;}
.res-loc{display:flex;align-items:center;gap:5px;font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:11px;letter-spacing:.07em;text-transform:uppercase;background:var(--card);border:1px solid var(--border2);padding:7px 13px;}
.res-loc i{color:var(--red);font-size:10px;}
.tech-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(285px,1fr));gap:1px;background:var(--border);border-top:1px solid var(--border);}
.t-card{background:var(--black);padding:24px;display:flex;flex-direction:column;gap:12px;transition:background .2s;position:relative;}
.t-card:hover{background:#0f0f0f;}
.t-card.top::before{content:'TOP NOTÃ‰';position:absolute;top:12px;right:12px;font-family:'Anton',sans-serif;font-size:10px;letter-spacing:.1em;background:var(--red);color:var(--white);padding:3px 8px;}
.t-ava{width:48px;height:48px;display:flex;align-items:center;justify-content:center;font-family:'Anton',sans-serif;font-size:15px;flex-shrink:0;border-radius:4px;}
.t-nm{font-family:'Barlow Condensed',sans-serif;font-weight:900;font-size:16px;letter-spacing:.02em;}
.t-sp{font-size:11px;letter-spacing:.06em;text-transform:uppercase;font-family:'Barlow Condensed',sans-serif;font-weight:700;color:var(--gray);}
.avdot{width:8px;height:8px;border-radius:50%;flex-shrink:0;}
.avdot.g{background:var(--green);box-shadow:0 0 6px var(--green);}
.avdot.y{background:var(--yellow);box-shadow:0 0 6px var(--yellow);}
.t-tags{display:flex;flex-wrap:wrap;gap:4px;}
.t-tag{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:10px;letter-spacing:.06em;text-transform:uppercase;padding:3px 7px;border:1px solid var(--border2);color:var(--gray);}
.t-price-row{display:flex;align-items:center;justify-content:space-between;border-top:1px solid var(--border);padding-top:12px;}
.t-price{font-family:'Anton',sans-serif;font-size:18px;}
.t-price span{font-size:11px;font-family:'Barlow',sans-serif;font-weight:400;color:var(--gray);}
.btn-hire{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:11px;letter-spacing:.07em;text-transform:uppercase;background:var(--red);color:var(--white);border:none;cursor:pointer;padding:9px 18px;transition:background .2s,transform .14s;}
.btn-hire:hover{background:#c01028;transform:scale(1.04);}

/* Booking Modal */
.overlay{position:fixed;inset:0;z-index:200;background:rgba(0,0,0,.9);backdrop-filter:blur(4px);display:none;align-items:center;justify-content:center;padding:16px;}
.overlay.open{display:flex;}
.modal{background:#0d0d0d;border:1px solid var(--border2);width:100%;max-width:490px;max-height:93vh;overflow-y:auto;}
.modal-head{padding:18px 22px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
.modal-ttl{font-family:'Anton',sans-serif;font-size:16px;letter-spacing:-.01em;}
.modal-x{width:28px;height:28px;border:1px solid var(--border2);background:transparent;color:var(--gray);cursor:pointer;font-size:12px;display:flex;align-items:center;justify-content:center;transition:border-color .2s,color .2s;}
.modal-x:hover{border-color:var(--white);color:var(--white);}
.modal-body{padding:20px 22px;}
.m-tinfo{display:flex;align-items:center;gap:12px;padding:14px;background:var(--black);border:1px solid var(--border);margin-bottom:16px;}
.m-ava{width:48px;height:48px;display:flex;align-items:center;justify-content:center;font-family:'Anton',sans-serif;font-size:15px;flex-shrink:0;border-radius:4px;}
.m-nm{font-family:'Barlow Condensed',sans-serif;font-weight:900;font-size:15px;}
.m-sub{font-size:11px;color:var(--gray);letter-spacing:.03em;}
.m-mission{background:var(--black);border:1px solid var(--border);margin-bottom:16px;}
.m-mission-head{padding:9px 13px;border-bottom:1px solid var(--border);font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:11px;letter-spacing:.12em;text-transform:uppercase;color:var(--gray);}
.m-row{display:flex;justify-content:space-between;align-items:flex-start;padding:9px 13px;border-bottom:1px solid var(--border);}
.m-row:last-child{border-bottom:none;}
.m-k{color:var(--gray);font-family:'Barlow Condensed',sans-serif;font-weight:600;font-size:11px;letter-spacing:.05em;flex-shrink:0;}
.m-v{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:13px;text-align:right;}
.m-pv{font-family:'Anton',sans-serif;font-size:20px;color:var(--red);}
.lbl{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:11px;letter-spacing:.12em;text-transform:uppercase;color:var(--gray);display:block;margin-bottom:6px;}
.inp{width:100%;background:var(--black);border:1px solid var(--border2);color:var(--white);padding:11px 13px;font-size:14px;font-family:'Barlow',sans-serif;outline:none;transition:border-color .2s;margin-bottom:13px;}
.inp:focus{border-color:var(--red);}
.pay-opts{display:grid;grid-template-columns:1fr 1fr;gap:7px;margin-bottom:16px;}
.pay-opt{padding:13px;border:1px solid var(--border2);cursor:pointer;transition:border-color .2s,background .2s;position:relative;}
.pay-opt:hover{border-color:#444;}
.pay-opt.sel{border-color:var(--red);background:rgba(227,24,55,.05);}
.pay-opt.sel .p-chk{display:flex;}
.p-chk{position:absolute;top:7px;right:7px;width:15px;height:15px;border-radius:50%;background:var(--red);display:none;align-items:center;justify-content:center;font-size:9px;}
.p-icon{font-size:17px;margin-bottom:5px;}
.p-nm{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:13px;letter-spacing:.04em;}
.p-dsc{font-size:11px;color:var(--gray);margin-top:2px;}
.btn-confirm{width:100%;font-family:'Anton',sans-serif;font-size:16px;letter-spacing:.03em;background:var(--red);color:var(--white);border:none;cursor:pointer;padding:15px;display:flex;align-items:center;justify-content:center;gap:10px;transition:background .2s;}
.btn-confirm:hover{background:#c01028;}
.btn-confirm:disabled{background:#333;cursor:not-allowed;}

/* Loading Screen */
#loading-screen{position:fixed;inset:0;z-index:400;background:var(--black);display:none;align-items:center;justify-content:center;flex-direction:column;padding:20px;text-align:center;}
#loading-screen.open{display:flex;}
.loading-logo{font-family:'Anton',sans-serif;font-size:22px;letter-spacing:-.02em;margin-bottom:44px;}
.loading-logo span{color:var(--red);}
.loading-steps{width:100%;max-width:360px;}
.l-step{display:flex;align-items:center;gap:13px;padding:14px 18px;border:1px solid var(--border);margin-bottom:-1px;background:var(--black);position:relative;z-index:1;transition:background .3s,border-color .3s;}
.l-step.active{background:#0f0f0f;}
.l-step.done{border-color:rgba(34,197,94,.25);}
.l-icon{width:26px;height:26px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:11px;flex-shrink:0;border:1px solid var(--border2);color:var(--gray);transition:all .3s;}
.l-step.active .l-icon{border-color:var(--red);color:var(--red);animation:spin 1s linear infinite;}
.l-step.done .l-icon{border-color:var(--green);color:var(--green);background:rgba(34,197,94,.08);}
.l-txt{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:13px;letter-spacing:.04em;}
.l-step.active .l-txt{color:var(--white);}
.l-step.done .l-txt{color:var(--green);}
.l-step:not(.active):not(.done) .l-txt{color:var(--gray);}
.loading-bar-wrap{width:360px;max-width:100%;height:2px;background:var(--border2);margin-top:22px;overflow:hidden;}
.loading-bar{height:100%;background:var(--red);width:0%;transition:width .4s ease;}

/* Waiting View */
.waiting-ring{position:relative;width:80px;height:80px;margin:0 auto 28px;}
.waiting-ring::before,.waiting-ring::after{content:'';position:absolute;inset:0;border-radius:50%;}
.waiting-ring::before{border:2px solid var(--border2);}
.waiting-ring::after{border:2px solid transparent;border-top-color:var(--red);animation:spin 1.2s linear infinite;}
.waiting-ring-inner{position:absolute;inset:12px;border-radius:50%;background:rgba(227,24,55,.08);display:flex;align-items:center;justify-content:center;font-size:20px;color:var(--red);}
.waiting-pulse{position:absolute;inset:-8px;border-radius:50%;border:2px solid rgba(227,24,55,.3);animation:pulse-ring 2s ease-out infinite;}
.waiting-title{font-family:'Anton',sans-serif;font-size:clamp(30px,6vw,58px);letter-spacing:-.02em;margin-bottom:8px;animation:fiu .6s ease both;}
.waiting-sub{font-family:'Barlow Condensed',sans-serif;font-size:16px;color:var(--gray);margin-bottom:32px;animation:fiu .6s .1s ease both;}
.waiting-card{width:100%;max-width:460px;background:#0d0d0d;border:1px solid var(--border2);margin-bottom:20px;animation:fiu .6s .2s ease both;}
.wc-header{padding:14px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
.wc-title{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:11px;letter-spacing:.12em;text-transform:uppercase;color:var(--gray);}
.wc-id{font-family:'Anton',sans-serif;font-size:12px;letter-spacing:.06em;color:var(--red);}
.wc-tech{display:flex;align-items:center;gap:12px;padding:16px 20px;border-bottom:1px solid var(--border);background:var(--black);}
.wc-ava{width:46px;height:46px;display:flex;align-items:center;justify-content:center;font-family:'Anton',sans-serif;font-size:14px;flex-shrink:0;border-radius:4px;}
.wc-nm{font-family:'Barlow Condensed',sans-serif;font-weight:900;font-size:15px;}
.wc-sp{font-size:11px;color:var(--gray);letter-spacing:.04em;}
.wc-rows{}
.wc-row{display:flex;justify-content:space-between;padding:10px 20px;border-bottom:1px solid var(--border);font-size:13px;}
.wc-row:last-child{border-bottom:none;}
.wc-k{color:var(--gray);font-family:'Barlow Condensed',sans-serif;font-weight:600;font-size:12px;letter-spacing:.05em;text-transform:uppercase;}
.wc-v{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:13px;text-align:right;}
.wc-status{padding:12px 20px;display:flex;align-items:center;gap:10px;}
.wc-status.waiting{background:rgba(245,158,11,.06);border-top:1px solid rgba(245,158,11,.15);}
.wc-status.accepted{background:rgba(34,197,94,.06);border-top:1px solid rgba(34,197,94,.2);}
.wc-status.declined{background:rgba(239,68,68,.06);border-top:1px solid rgba(239,68,68,.2);}
.status-dot-w{width:8px;height:8px;border-radius:50%;background:var(--yellow);box-shadow:0 0 6px var(--yellow);animation:pd 1.5s infinite;}
.status-dot-g{width:8px;height:8px;border-radius:50%;background:var(--green);box-shadow:0 0 8px var(--green);}
.status-dot-r{width:8px;height:8px;border-radius:50%;background:#ef4444;box-shadow:0 0 8px #ef4444;}
.status-txt{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:13px;letter-spacing:.04em;}
.wa-sent-note{display:flex;align-items:center;gap:8px;font-family:'Barlow Condensed',sans-serif;font-weight:600;font-size:12px;color:var(--gray);border:1px solid var(--border2);padding:10px 16px;max-width:460px;width:100%;margin-bottom:20px;animation:fiu .6s .3s ease both;}
.wa-sent-note i{color:#25D366;font-size:14px;}
.declined-box{width:100%;max-width:460px;background:#0d0d0d;border:1px solid rgba(239,68,68,.25);padding:24px;text-align:center;margin-bottom:20px;animation:fiu .5s ease both;}
.declined-icon{font-size:32px;margin-bottom:12px;color:#ef4444;}
.declined-title{font-family:'Anton',sans-serif;font-size:24px;letter-spacing:-.01em;margin-bottom:6px;}
.declined-sub{font-family:'Barlow Condensed',sans-serif;font-size:14px;color:var(--gray);margin-bottom:20px;}

/* Final Confirm View */
#view-final{padding-top:80px;}
.final-badge{display:inline-flex;align-items:center;gap:8px;font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:11px;letter-spacing:.14em;text-transform:uppercase;color:var(--green);border:1px solid rgba(34,197,94,.3);padding:6px 13px;margin-bottom:22px;animation:fiu .5s ease both;}
.final-check{width:64px;height:64px;border-radius:50%;background:rgba(34,197,94,.1);border:1px solid rgba(34,197,94,.4);display:flex;align-items:center;justify-content:center;font-size:26px;color:var(--green);margin:0 auto 22px;animation:pop .5s cubic-bezier(.34,1.56,.64,1) both;}
#view-final h1{font-family:'Anton',sans-serif;font-size:clamp(32px,7vw,72px);letter-spacing:-.02em;margin-bottom:6px;animation:fiu .6s .1s ease both;}
.final-sub{font-family:'Barlow Condensed',sans-serif;font-size:16px;color:var(--gray);margin-bottom:28px;animation:fiu .6s .2s ease both;}
.final-card{width:100%;max-width:500px;background:#0d0d0d;border:1px solid rgba(34,197,94,.2);margin-bottom:16px;animation:fiu .6s .3s ease both;}
.fc-header{padding:14px 20px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;}
.fc-title{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:11px;letter-spacing:.12em;text-transform:uppercase;color:var(--gray);}
.fc-id{font-family:'Anton',sans-serif;font-size:12px;letter-spacing:.06em;color:var(--red);}
.fc-tech{display:flex;align-items:center;gap:12px;padding:16px 20px;border-bottom:1px solid var(--border);background:var(--black);}
.fc-ava{width:48px;height:48px;display:flex;align-items:center;justify-content:center;font-family:'Anton',sans-serif;font-size:15px;flex-shrink:0;border-radius:4px;}
.fc-nm{font-family:'Barlow Condensed',sans-serif;font-weight:900;font-size:16px;}
.fc-sub{font-size:11px;color:var(--gray);margin-top:2px;}
.fc-price-right{margin-left:auto;text-align:right;}
.fc-price{font-family:'Anton',sans-serif;font-size:22px;color:var(--green);}
.fc-pricelab{font-size:11px;color:var(--gray);font-family:'Barlow Condensed',sans-serif;font-weight:600;}
.fc-rows{}
.fc-row{display:flex;justify-content:space-between;align-items:center;padding:11px 20px;border-bottom:1px solid var(--border);}
.fc-row:last-child{border-bottom:none;}
.fck{color:var(--gray);font-family:'Barlow Condensed',sans-serif;font-weight:600;font-size:12px;letter-spacing:.05em;text-transform:uppercase;flex-shrink:0;}
.fcv{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:13px;text-align:right;max-width:280px;}
.fcv.green{color:var(--green);}
.fcv.red{color:var(--red);}
.fc-accepted-bar{padding:12px 20px;background:rgba(34,197,94,.07);border-top:1px solid rgba(34,197,94,.2);display:flex;align-items:center;gap:9px;}
.fc-accepted-dot{width:8px;height:8px;border-radius:50%;background:var(--green);box-shadow:0 0 8px var(--green);}
.fc-accepted-txt{font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:13px;color:var(--green);letter-spacing:.04em;}
.d-note-bar{display:flex;align-items:center;gap:8px;background:var(--card);border:1px solid var(--border2);padding:10px 16px;max-width:500px;width:100%;font-family:'Barlow Condensed',sans-serif;font-weight:600;font-size:12px;color:var(--gray);margin-bottom:20px;animation:fiu .6s .4s ease both;}
.d-note-bar i.fa-discord{color:#5865F2;}
.d-note-bar i.fa-whatsapp{color:#25D366;}

/* Tech Panel */
#view-tech{background:#050505;}
.tech-panel-header{
  padding:28px 32px;
  border-bottom:1px solid var(--border);
  display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:12px;
}
.tp-logo{font-family:'Anton',sans-serif;font-size:18px;letter-spacing:-.02em;}
.tp-logo span{color:var(--red);}
.tp-badge{display:flex;align-items:center;gap:7px;font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:12px;color:#25D366;padding:6px 12px;border:1px solid rgba(37,211,102,.25);background:rgba(37,211,102,.06);}
.tp-badge i{font-size:11px;}
.tech-panel-body{padding:32px;}
.tp-empty{text-align:center;padding:60px 20px;}
.tp-empty i{font-size:40px;color:var(--border2);margin-bottom:16px;}
.tp-empty p{font-family:'Barlow Condensed',sans-serif;font-size:15px;color:var(--gray);}

/* Responsive */
@media(max-width:768px){
  nav{padding:0 16px;}
  .nav-links{display:none;}
  .hero{padding:56px 16px 36px;}
  .hero h1{font-size:58px;}
  .stats-row{grid-template-columns:1fr 1fr;}
  .stat-cell{border-right:none;border-bottom:1px solid var(--border);padding:22px 16px;}
  .sec-header{padding:32px 16px 18px;flex-direction:column;align-items:flex-start;}
  .join-banner{padding:40px 16px;flex-direction:column;}
  footer{padding:32px 16px;}
  .f-bottom{padding:12px 16px;}
  .breadcrumb{padding:12px 16px 0;}
  .prob-hero{padding:20px 16px;}
  .res-header{padding:16px;}
  .prob-list,.tech-grid,.svc-grid{grid-template-columns:1fr;}
  .tech-panel-body{padding:16px;}
  .tp-logo{font-size:15px;}
  .form-grid{grid-template-columns:1fr;}
}
</style>
</head>
<body>
<div id="cursor"></div>

<!-- LOGIN GATE - Double rÃ´le Client / Technicien -->
<div id="login-gate">
  <div class="login-box">
    <div class="login-logo">MEN<span>TECH</span></div>
    <div class="login-head">
      <h2>BIENVENUE.</h2>
      <p>Choisissez votre mode de connexion</p>
    </div>
    <div class="login-body">
      <!-- SÃ©lecteur de rÃ´le -->
      <div class="role-switch">
        <div class="role-opt active" id="role-client" onclick="switchRole('client')">CLIENT</div>
        <div class="role-opt" id="role-tech" onclick="switchRole('tech')">TECHNICIEN</div>
      </div>
      
      <!-- Champs Client -->
      <div id="client-login-fields">
        <label class="login-lbl">Votre prÃ©nom</label>
        <input class="login-inp" id="login-input" type="text" placeholder="Ex: Yassine, Sara, Omar...">
      </div>
      
      <!-- Champs Technicien (cachÃ©s par dÃ©faut) -->
      <div id="tech-login-fields">
        <div class="tech-login-note">
          <i class="fas fa-key" style="color:var(--red); margin-right:5px;"></i> 
          Utilisez vos identifiants fournis par l'administrateur
        </div>
        <label class="login-lbl">Identifiant technicien</label>
        <input class="login-inp" id="tech-id" type="text" placeholder="Ex: TECH123">
        <label class="login-lbl">Mot de passe</label>
        <input class="login-inp" id="tech-pass" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢">
      </div>
      
      <div class="login-err" id="login-err"></div>
      
      <button class="login-btn" onclick="doLogin()">
        <i class="fas fa-arrow-right"></i> SE CONNECTER
      </button>
      
      <!-- Lien vers recrutement -->
      <div style="text-align:center; margin:15px 0 5px;">
        <span style="color:var(--gray); font-size:12px;">Vous Ãªtes technicien ?</span>
        <button class="btn-o" style="margin-left:8px; padding:5px 12px;" onclick="showRecrutement()">Rejoindre l'Ã©quipe</button>
      </div>
    </div>
    <div class="login-disc">Votre prÃ©nom apparaÃ®tra dans les confirmations de mission</div>
  </div>
</div>

<!-- NAVIGATION -->
<nav>
  <div class="logo" onclick="handleLogoClick()">MEN<span>TECH</span></div>
  <div class="nav-links">
    <span class="nav-link" onclick="goHome()">Accueil</span>
    <span class="nav-link" onclick="scrollSvc()">Services</span>
    <span class="nav-link" onclick="allTechs()">Techniciens</span>
    <span class="nav-link" id="nav-tech-link" style="display:none;color:var(--green);" onclick="showTechPanel()">
      <i class="fas fa-toolbox" style="font-size:10px;margin-right:4px;"></i>Panel Tech
      <span class="tech-notif-badge"><span class="tech-notif-dot" id="tech-notif-dot"></span></span>
    </span>
  </div>
  <div class="nav-right">
    <div id="loc-pill" onclick="detectLoc()">
      <i class="fas fa-location-dot"></i>
      <span id="loc-txt">Localiser</span>
    </div>
    <div class="user-badge" id="user-badge" style="display:none;">
      <i class="fas fa-user"></i>
      <span id="user-badge-name"></span>
    </div>
    <button class="btn-r" onclick="scrollSvc()">Demander</button>
  </div>
</nav>

<!-- VIEW: HOME -->
<div class="view active" id="view-home">
  <section class="hero">
    <div class="hero-grid"></div>
    <div class="hero-glow"></div>
    <div style="position:relative;z-index:1;">
      <div class="badge-pill"><span class="pulse-dot"></span> En ligne 24h/7j â€” Maroc</div>
      <h1>JUST<br>FIX<br><em>IT.</em></h1>
      <p class="hero-sub">La plateforme NÂ°1 au Maroc pour trouver un technicien certifiÃ© prÃ¨s de chez vous.</p>
      <div class="hero-btns">
        <button class="hero-cta" onclick="scrollSvc()">Trouver un expert <i class="fas fa-arrow-right" style="font-size:12px;"></i></button>
        <button class="hero-ghost" onclick="detectLoc()"><i class="fas fa-location-dot" style="color:var(--red);margin-right:7px;"></i>Me localiser</button>
      </div>
    </div>
  </section>
  <div class="ticker"><div class="ticker-track" id="ticker"></div></div>
  <div class="stats-row">
    <div class="stat-cell"><div class="stat-n">2,4K<em>+</em></div><div class="stat-l">Techniciens actifs</div></div>
    <div class="stat-cell"><div class="stat-n">98<em>%</em></div><div class="stat-l">Satisfaction client</div></div>
    <div class="stat-cell"><div class="stat-n">45<em style="font-size:22px;">min</em></div><div class="stat-l">Intervention moyenne</div></div>
    <div class="stat-cell"><div class="stat-n">12K<em>+</em></div><div class="stat-l">Missions rÃ©ussies</div></div>
  </div>
  <div id="services-anchor">
    <div class="sec-header">
      <div><div class="eyebrow">// CatÃ©gories</div><div class="sec-title">CHOISISSEZ<br>VOTRE SERVICE</div></div>
      <span class="sec-action" onclick="allTechs()">Tous les techniciens <i class="fas fa-arrow-right"></i></span>
    </div>
    <div class="svc-grid" id="svc-grid"></div>
  </div>
  <div class="join-banner">
    <div>
      <div class="join-h">REJOIGNEZ<br>L'Ã‰QUIPE</div>
      <div class="join-p">Vous Ãªtes technicien ? Inscrivez-vous maintenant.<br>Contact : <strong>0719 089 944</strong></div>
    </div>
    <button class="btn-w" onclick="showRecrutement()">Devenir technicien â†’</button>
  </div>
  <footer>
    <div><div class="f-logo">MEN<span>TECH</span></div><div class="f-tag">Just Fix It. â€” Maroc</div></div>
    <div class="f-col"><h4>Services</h4><a href="#">Ã‰lectricitÃ©</a><a href="#">Plomberie</a><a href="#">Antenne/Parabole</a><a href="#">TÃ©lÃ©phone</a><a href="#">Climatisation</a></div>
    <div class="f-col"><h4>Plateforme</h4><a href="#">Comment Ã§a marche</a><a href="#">Tarifs</a><a href="#">Devenir technicien</a></div>
    <div class="f-col"><h4>Contact</h4><a href="tel:0719089944">ğŸ“ 0719 089 944</a><a href="#">contact@mentech.ma</a><a href="#">Rabat, Maroc</a></div>
  </footer>
  <div class="f-bottom">
    <span class="f-copy">Â© 2025 MENTECH. Tous droits rÃ©servÃ©s.</span>
    <span class="f-copy">Paiement sÃ©curisÃ© Â· Garantie satisfaction</span>
  </div>
</div>

<!-- VIEW: RECRUTEMENT / DEPOT CV -->
<div class="view-flex" id="view-recrutement">
  <div class="recrutement-section">
    <div class="recrutement-header">
      <h1>REJOINDRE <span>MENTECH</span></h1>
      <p>Devenez technicien partenaire et dÃ©veloppez votre activitÃ©</p>
    </div>
    
    <div id="cv-success" class="success-message">
      <i class="fas fa-check-circle"></i> Candidature envoyÃ©e ! Notre Ã©quipe vous contactera sous 48h.
    </div>
    
    <div class="recrutement-form">
      <div class="form-grid">
        <div class="form-group">
          <label class="form-label">PrÃ©nom</label>
          <input class="form-input" id="cv-prenom" type="text" placeholder="Votre prÃ©nom">
        </div>
        <div class="form-group">
          <label class="form-label">Nom</label>
          <input class="form-input" id="cv-nom" type="text" placeholder="Votre nom">
        </div>
        <div class="form-group">
          <label class="form-label">TÃ©lÃ©phone</label>
          <input class="form-input" id="cv-tel" type="tel" placeholder="06 XX XX XX XX">
        </div>
        <div class="form-group">
          <label class="form-label">Email</label>
          <input class="form-input" id="cv-email" type="email" placeholder="email@exemple.com">
        </div>
        <div class="form-group full">
          <label class="form-label">Ville</label>
          <input class="form-input" id="cv-ville" type="text" placeholder="Votre ville">
        </div>
        <div class="form-group full">
          <label class="form-label">SpÃ©cialitÃ© principale</label>
          <select class="form-select" id="cv-specialite">
            <option value="electricite">Ã‰lectricitÃ©</option>
            <option value="plomberie">Plomberie</option>
            <option value="antenne">Antenne / Parabole</option>
            <option value="telephone">TÃ©lÃ©phone / Smartphone</option>
            <option value="climatisation">Climatisation</option>
            <option value="menuiserie">Menuiserie / Bois</option>
            <option value="peinture">Peinture / DÃ©coration</option>
            <option value="aluminium">Aluminium / Vitrage</option>
            <option value="nettoyage">Nettoyage Ã  domicile</option>
            <option value="surveillance">CamÃ©ras de surveillance</option>
            <option value="jardin">AmÃ©nagement jardin</option>
            <option value="coiffure">Coiffure Ã  domicile</option>
          </select>
        </div>
        <div class="form-group full">
          <label class="form-label">ExpÃ©rience (annÃ©es)</label>
          <input class="form-input" id="cv-exp" type="number" min="0" max="50" value="3">
        </div>
        <div class="form-group full">
          <label class="form-label">DÃ©poser votre CV (PDF)</label>
          <div class="form-file" onclick="document.getElementById('cv-file').click()">
            <i class="fas fa-cloud-upload-alt" style="font-size:24px; color:var(--red); margin-bottom:8px; display:block;"></i>
            <span id="cv-file-name">Cliquez pour sÃ©lectionner un fichier PDF</span>
          </div>
          <input type="file" id="cv-file" accept=".pdf" style="display:none;" onchange="updateFileName(this)">
          <div class="upload-note">Format acceptÃ© : PDF uniquement Â· Max 10 Mo</div>
        </div>
      </div>
      
      <button class="btn-submit-cv" onclick="submitCV()">
        <i class="fas fa-paper-plane"></i> ENVOYER MA CANDIDATURE
      </button>
    </div>
  </div>
</div>

<!-- VIEW: PROBLEMS -->
<div class="view" id="view-problems">
  <div class="breadcrumb"><a onclick="goHome()">Accueil</a><span class="sep">â€º</span><span class="cur" id="bc-svc">Service</span></div>
  <div class="prob-hero">
    <div class="svc-tag-lbl" id="svc-tag-lbl"></div>
    <h1>QUEL EST<br>LE <em style="color:var(--red);">PROBLÃˆME</em>&nbsp;?</h1>
    <p>SÃ©lectionnez votre problÃ¨me â€” nous trouvons les techniciens disponibles prÃ¨s de vous.</p>
  </div>
  <div class="prob-list" id="prob-list"></div>
</div>

<!-- VIEW: RESULTS -->
<div class="view" id="view-results">
  <div class="breadcrumb">
    <a onclick="goHome()">Accueil</a><span class="sep">â€º</span>
    <a onclick="backToProbs()" id="bc-svc2">Service</a><span class="sep">â€º</span>
    <span class="cur" id="bc-prob">ProblÃ¨me</span>
  </div>
  <div class="res-header">
    <div><div class="eyebrow" style="margin-bottom:3px;">// RÃ©sultats</div><div class="res-meta" id="res-meta"></div></div>
    <div class="res-loc"><i class="fas fa-location-dot"></i><span id="res-loc-txt">Votre ville</span></div>
  </div>
  <div class="tech-grid" id="tech-grid"></div>
</div>

<!-- VIEW: WAITING -->
<div class="view-flex" id="view-waiting"></div>

<!-- VIEW: TECH PANEL -->
<div class="view" id="view-tech">
  <div class="tech-panel-header">
    <div>
      <div class="tp-logo">MEN<span>TECH</span> â€” <span style="color:var(--green);font-size:15px;">PANEL TECHNICIEN</span></div>
      <div style="font-family:'Barlow Condensed',sans-serif;font-size:12px;color:var(--gray);margin-top:3px;letter-spacing:.04em;" id="tech-panel-info"></div>
    </div>
    <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap;">
      <div class="tp-badge"><i class="fab fa-whatsapp"></i> Notifications WhatsApp <span id="wa-status">actives</span></div>
      <button class="btn-o" onclick="goHome()" style="font-size:11px;padding:7px 14px;">â† Sortir</button>
    </div>
  </div>
  <div class="tech-panel-body">

    <!-- CallMeBot Setup -->
    <div class="setup-box" id="callmebot-setup">
      <h4><i class="fab fa-whatsapp"></i> Activer les notifications WhatsApp</h4>
      <p>Pour recevoir les missions directement sur votre WhatsApp (<strong>0719089944</strong>), activez CallMeBot en une seule fois :</p>
      <p><strong style="color:var(--white);">Ã‰tape 1 :</strong> Envoyez ce message sur WhatsApp au <code>+34 644 09 73 43</code> :<br>
      <code style="display:inline-block;margin-top:4px;padding:6px 10px;font-size:13px;">I allow callmebot to send me messages</code></p>
      <p style="margin-top:8px;"><strong style="color:var(--white);">Ã‰tape 2 :</strong> Vous recevrez votre clÃ© API par message. Entrez-la ici :</p>
      <input class="setup-inp" id="callmebot-key-inp" type="text" placeholder="Entrez votre clÃ© API CallMeBot (ex: 1234567)">
      <div style="display:flex;align-items:center;gap:12px;margin-top:8px;">
        <button class="btn-save-key" onclick="saveCallMeBotKey()">Sauvegarder la clÃ©</button>
        <span class="key-saved" id="key-saved"><i class="fas fa-check"></i> ClÃ© sauvegardÃ©e !</span>
      </div>
    </div>

    <!-- Mission queue -->
    <div style="margin-bottom:16px;">
      <div class="eyebrow">// Missions en attente</div>
    </div>
    <div id="tech-mission-list">
      <div class="tp-empty">
        <i class="fas fa-inbox"></i>
        <p>Aucune mission en attente pour le moment.</p>
      </div>
    </div>
  </div>
</div>

<!-- VIEW: FINAL CONFIRM -->
<div class="view-flex" id="view-final"></div>

<!-- BOOKING MODAL -->
<div class="overlay" id="overlay" onclick="closeModal(event)">
  <div class="modal" onclick="event.stopPropagation()">
    <div class="modal-head">
      <span class="modal-ttl">Confirmer la mission</span>
      <button class="modal-x" onclick="closeModal()"><i class="fas fa-times"></i></button>
    </div>
    <div class="modal-body">
      <div class="m-tinfo" id="m-tinfo"></div>
      <div class="m-mission">
        <div class="m-mission-head">RÃ©capitulatif</div>
        <div id="m-mission-rows"></div>
      </div>
      <label class="lbl">Votre numÃ©ro de tÃ©lÃ©phone</label>
      <input class="inp" id="client-phone" type="tel" placeholder="Ex: 0661 234 567">
      <label class="lbl">Adresse d'intervention</label>
      <input class="inp" id="client-addr" type="text" placeholder="Ex: 12 Rue Hassan II, Ain Aouda">
      <label class="lbl">Note pour le technicien <span style="color:#444;font-size:10px;">(optionnel)</span></label>
      <input class="inp" id="client-note" type="text" placeholder="Ex: 3Ã¨me Ã©tage, sonner 2 fois">
      <label class="lbl">Mode de paiement</label>
      <div class="pay-opts">
        <div class="pay-opt sel" onclick="selPay('online')">
          <div class="p-chk"><i class="fas fa-check"></i></div>
          <div class="p-icon">ğŸ’³</div><div class="p-nm">En ligne</div><div class="p-dsc">Carte bancaire sÃ©curisÃ©e</div>
        </div>
        <div class="pay-opt" onclick="selPay('cash')">
          <div class="p-chk"><i class="fas fa-check"></i></div>
          <div class="p-icon">ğŸ’µ</div><div class="p-nm">Cash</div><div class="p-dsc">Paiement Ã  la livraison</div>
        </div>
      </div>
      <button class="btn-confirm" id="btn-ok" onclick="doConfirm()">
        <i class="fas fa-bolt"></i> CONFIRMER ET ENVOYER
      </button>
    </div>
  </div>
</div>

<!-- LOADING SCREEN -->
<div id="loading-screen">
  <div class="loading-logo">MEN<span>TECH</span></div>
  <div class="loading-steps">
    <div class="l-step" id="lstep-0"><div class="l-icon"><i class="fas fa-circle-notch"></i></div><div class="l-txt">Validation de la demande...</div></div>
    <div class="l-step" id="lstep-1"><div class="l-icon"><i class="fas fa-satellite-dish"></i></div><div class="l-txt">Recherche du technicien...</div></div>
    <div class="l-step" id="lstep-2"><div class="l-icon"><i class="fab fa-whatsapp"></i></div><div class="l-txt">Notification WhatsApp envoyÃ©e...</div></div>
    <div class="l-step" id="lstep-3"><div class="l-icon"><i class="fas fa-paper-plane"></i></div><div class="l-txt">En attente de rÃ©ponse...</div></div>
  </div>
  <div class="loading-bar-wrap"><div class="loading-bar" id="loading-bar"></div></div>
</div>

<script>
// ============================================
// CONFIGURATION
// ============================================
const DISCORD_WEBHOOK = 'https://discord.com/api/webhooks/1473811156626837617/N1_ynWzRTcgErVHaV2OiOq8bWmAnLtU8FDOqAYOia621T6u-XhIrfBJgHE6t4EPzbDhC';
const RECRUTEMENT_WEBHOOK = 'https://discord.com/api/webhooks/1473825828700946555/TU29M7GsUXb24Hn8nphfviURKa3uHdt6KA5JyVWvzkLvj83Moy7UdZWR0-GXE1O-fIYj';
const TECH_PHONE_INTL = '212719089944';
const TECH_NAME_REAL = 'Yassine Ezher';
const TECH_PHONE_DISPLAY = '0719 089 944';

// Comptes techniciens autorisÃ©s
const TECH_ACCOUNTS = {
  'TECH001': 'mentech2025',
  'TECH123': 'password123',
  'YASSINE': 'ezher123'
};

// ============================================
// SERVICE DATA - TOUS LES SERVICES INCLUS
// ============================================
const SVCS = [
  {id:'electricite', name:'Ã‰lectricitÃ©', icon:'fa-bolt', a:'#f59e0b', ab:'rgba(245,158,11,.1)', desc:'Panne, cÃ¢blage, tableau Ã©lectrique, installation.', count:'340+',
   probs:['Panne de courant gÃ©nÃ©rale','Court-circuit','Disjoncteur qui saute souvent','Prise Ã©lectrique dÃ©fectueuse','Interrupteur qui ne fonctionne pas','Ampoule / Plafonnier grillÃ©','Installation Ã©clairage (LED, spots)','Installation de prises supplÃ©mentaires','CÃ¢blage / Gaines Ã©lectriques','Tableau Ã©lectrique (remplacement / mise Ã  niveau)','Compteur Ã©lectrique ONEE','Installation four encastrÃ© / plaque induction','Installation chauffe-eau Ã©lectrique','ProblÃ¨me de terre (mise Ã  la terre)','Installation VMC / ventilation','CÃ¢blage rÃ©seau / tÃ©lÃ© / antenne','Installation minuterie / dÃ©tecteur mouvement','RÃ©novation Ã©lectrique complÃ¨te','Certification Ã©lectrique / bilan']},
  {id:'plomberie', name:'Plomberie', icon:'fa-faucet', a:'#3b82f6', ab:'rgba(59,130,246,.1)', desc:"Fuites, dÃ©bouchage, chauffe-eau, sanitaire.", count:'290+',
   probs:["Fuite d'eau (robinet / tuyau)","Canalisation bouchÃ©e / dÃ©bouchage","WC bouchÃ© (dÃ©bouchage)","Ã‰vier de cuisine bouchÃ©","Douche / baignoire bouchÃ©e","Chauffe-eau en panne","Chauffe-eau qui ne chauffe plus","Ballon d'eau chaude Ã  remplacer","Fuite salle de bain (sol / joints)","Robinetterie Ã  remplacer","WC qui coule en permanence","Chasse d'eau dÃ©fectueuse","Siphon / bonde cassÃ©","Tuyauterie percÃ©e ou corrodÃ©e","Installation lave-linge / lave-vaisselle","Installation sanitaire complet (WC, lavabo)","ProblÃ¨me de pression d'eau","Vanne d'arrÃªt bloquÃ©e","DÃ©tection de fuite cachÃ©e","RÃ©novation salle de bain complÃ¨te"]},
  {id:'antenne', name:'Antenne / Parabole', icon:'fa-satellite-dish', a:'#a855f7', ab:'rgba(168,85,247,.1)', desc:'Signal, installation, orientation, dÃ©codeur.', count:'180+',
   probs:['Signal TNT faible ou inexistant','Pixelisation image TV','Aucune chaÃ®ne disponible','Pas de signal du tout (Ã©cran noir)','Installation antenne TNT neuve','Installation parabole (Nilesat, Arabsat, Hotbird)','Orientation / pointage satellite','CÃ¢ble coaxial endommagÃ©','RÃ©partiteur / splitter dÃ©fectueux','ProblÃ¨me dÃ©codeur (reset, config)','Mise Ã  jour dÃ©codeur satellite','Installation dÃ©codeur ADSL / IPTV','Antenne collective immeuble','Branchement plusieurs TV','Signal 4G / 5G perturbÃ©','Installation amplificateur signal','ProblÃ¨me amplificateur antenne','Remplacement LNB parabole','Fixation antenne (mÃ¢t, support)','VÃ©rification cÃ¢blage complet']},
  {id:'telephone', name:'TÃ©lÃ©phone / Smartphone', icon:'fa-mobile-alt', a:'#22c55e', ab:'rgba(34,197,94,.1)', desc:'Ã‰cran, batterie, logiciel, toutes marques.', count:'510+',
   probs:['Ã‰cran fissurÃ© / cassÃ© (vitre)','Remplacement Ã©cran LCD / OLED complet','Batterie gonfle ou ne charge plus','Autonomie trÃ¨s faible (remplacement batterie)','TÃ©lÃ©phone ne s\'allume plus','ProblÃ¨me de charge (connecteur USB / Lightning)','Micro ne fonctionne pas (voix inaudible)','Haut-parleur grillÃ© (son sourd ou absent)','CamÃ©ra arriÃ¨re cassÃ©e ou floue','CamÃ©ra frontale dÃ©fectueuse','Bouton Power bloquÃ© / cassÃ©','Boutons Volume dÃ©fectueux','Lecteur empreinte digitale HS','Face ID / reconnaissance faciale HS','TÃ©lÃ©phone lent (RAM / stockage plein)','Logiciel bloquÃ© / plantage (reset)','Mise Ã  jour systÃ¨me Ã©chouÃ©e','RÃ©cupÃ©ration de donnÃ©es (data recovery)','RÃ©paration aprÃ¨s chute dans l\'eau','Nappe flex endommagÃ©e','ProblÃ¨me rÃ©seau (pas de rÃ©seau)','Lecteur SIM dÃ©fectueux','ProblÃ¨me WiFi / Bluetooth','Vitre arriÃ¨re cassÃ©e','Chargeur sans fil (Qi) dÃ©fectueux']},
  {id:'climatisation', name:'Climatisation', icon:'fa-snowflake', a:'#06b6d4', ab:'rgba(6,182,212,.1)', desc:'Installation, panne, entretien, recharge gaz.', count:'160+',
   probs:['Climatiseur ne refroidit plus','Climatiseur ne chauffe plus (mode chaud)','Fuite de fluide frigorigÃ¨ne','Recharge de gaz (R410A, R32)','UnitÃ© intÃ©rieure qui goutte (fuite eau)','UnitÃ© extÃ©rieure qui fait du bruit','Bruit anormal (vibration / claquement)','Mauvaise odeur (moisissure)','TÃ©lÃ©commande perdue ou HS','Carte Ã©lectronique en panne','Moteur ventilateur bloquÃ©','Compresseur dÃ©fectueux','Thermostat mal Ã©talonnÃ©','Installation unitÃ© split neuve','DÃ©placement unitÃ© intÃ©rieure / extÃ©rieure','Nettoyage et entretien annuel','Remplacement filtre encrassÃ©','DÃ©sinfection et antibactÃ©rien','Installation climatisation multi-split','Programmateur / timer dÃ©fectueux']},
  {id:'refrigerateur', name:'RÃ©frigÃ©rateur / Frigo', icon:'fa-temperature-low', a:'#f97316', ab:'rgba(249,115,22,.1)', desc:'Compresseur, thermostat, joint, fuite.', count:'140+',
   probs:['Frigo ne refroidit plus du tout','RÃ©frigÃ©rateur trop chaud','CongÃ©lateur ne congÃ¨le plus','CongÃ©lateur givre excessivement','Bruit fort (compresseur / ventilateur)','Vibrations anormales','Fuite eau en dessous du frigo','Frigo qui consomme trop','Joint de porte usÃ© / dÃ©collÃ©','Porte qui ferme mal','Ã‰clairage intÃ©rieur en panne','Thermostat / contrÃ´le tempÃ©rature HS','Compresseur dÃ©fectueux','Carte Ã©lectronique en panne','Moteur ventilateur HS','Panne panneau de contrÃ´le (display)','RÃ©frigÃ©rateur amÃ©ricain (double porte)','Machine Ã  glaÃ§ons en panne','Distributeur eau HS','Remplacement joint complet']},
  {id:'machine-laver', name:'Machine Ã  Laver', icon:'fa-jug-detergent', a:'#0ea5e9', ab:'rgba(14,165,233,.1)', desc:'Panne moteur, essorage, fuite, programmateur.', count:'130+',
   probs:['Machine ne dÃ©marre pas','Machine bloquÃ©e en cours de cycle','N\'essore plus (linge mouillÃ©)','Fuite eau sous la machine','Porte bloquÃ©e / ne s\'ouvre plus','Erreur affichÃ©e sur l\'Ã©cran','Bruit fort (roulement, tambour)','Vibrations et dÃ©placement','N\'Ã©vacue plus l\'eau','Pompe de vidange bouchÃ©e / HS','RÃ©sistance / ne chauffe plus','Programmateur dÃ©fectueux','Carte Ã©lectronique en panne','Remplacement joint de hublot','Remplacement courroie','Roulement de tambour usÃ©','Remplacement pompe de vidange','Machine qui ne rince pas bien','Produit lessiviel bloquÃ© (bac)','Installation machine neuve']},
  {id:'menuiserie', name:'Menuiserie / Bois', icon:'fa-tree', a:'#8B5A2B', ab:'rgba(139,90,43,.1)', desc:'Portes, fenÃªtres, meubles, parquet.', count:'200+',
   probs:['Porte qui grince','FenÃªtre qui ferme mal','Installation porte neuve','Pose de parquet flottant','Meuble Ã  monter (IKEA)','RÃ©paration meuble ancien','BibliothÃ¨que sur mesure','Terrasse en bois','Escalier qui craque','Lambris / plafond bois','Pose de plinthes','Porte de placard']},
  {id:'peinture', name:'Peinture & DÃ©coration', icon:'fa-paint-roller', a:'#ec4899', ab:'rgba(236,72,153,.1)', desc:'IntÃ©rieur, extÃ©rieur, enduit, revÃªtements.', count:'220+',
   probs:['Peinture intÃ©rieure (chambre, salon)','Peinture cuisine et salle de bain','Peinture plafond','Peinture extÃ©rieure (faÃ§ade)','Ravalement de faÃ§ade complet','Enduit de lissage','Tadelakt marocain traditionnel','DÃ©collage ancien papier peint','Pose papier peint neuf','Peinture dÃ©corative (relief, texture)','Pose faÃ¯ence murale','Retouche peinture','Peinture fer / mÃ©tal','Vernis parquet / bois']},
  {id:'aluminium', name:'Aluminium & Vitrage', icon:'fa-window-maximize', a:'#94a3b8', ab:'rgba(148,163,184,.1)', desc:'FenÃªtres, portes, vÃ©randas, miroirs.', count:'150+',
   probs:['Vitre cassÃ©e / remplacement','FenÃªtre aluminium dÃ©formÃ©e','Porte coulissante bloquÃ©e','VÃ©randa Ã  installer','Miroir sur mesure','Double vitrage Ã  changer','Joint d\'Ã©tanchÃ©itÃ© usÃ©','FenÃªtre qui fuit','Store banne / volet']},
  {id:'nettoyage', name:'Nettoyage Ã  domicile', icon:'fa-broom', a:'#fbbf24', ab:'rgba(251,191,36,.1)', desc:'Nettoyage complet, vitres, tapis.', count:'300+',
   probs:['Nettoyage complet appartement','Nettoyage de printemps','Lavage de vitres','Nettoyage tapis / moquette','Nettoyage canapÃ©','DÃ©sinfection complÃ¨te','Nettoyage aprÃ¨s travaux','Nettoyage bureau']},
  {id:'surveillance', name:'CamÃ©ras de surveillance', icon:'fa-video', a:'#dc2626', ab:'rgba(220,38,38,.1)', desc:'Installation, configuration, dÃ©pannage.', count:'120+',
   probs:['Installation camÃ©ras extÃ©rieures','CamÃ©ra qui ne s\'allume pas','Vision nocturne dÃ©fectueuse','Configuration enregistreur','AccÃ¨s Ã  distance ne marche pas','Remplacement camÃ©ra','CÃ¢blage et alimentation']},
  {id:'jardin', name:'AmÃ©nagement jardin', icon:'fa-leaf', a:'#16a34a', ab:'rgba(22,163,74,.1)', desc:'Tonte, taille, plantation, arrosage.', count:'180+',
   probs:['Tonte de pelouse','Taille de haies','Nettoyage jardin','Installation arrosage automatique','CrÃ©ation massif fleuri','Abattage arbre','Traitement anti-moustiques','Pose de gazon synthÃ©tique']},
  {id:'coiffure', name:'Coiffure Ã  domicile', icon:'fa-cut', a:'#db2777', ab:'rgba(219,39,119,.1)', desc:'Pour femmes et hommes Ã  domicile.', count:'90+',
   probs:['Coupe femme','Coloration / mÃ¨ches','Brushing','Coupe homme','Barbe et moustache','Coiffure mariage','Extension de cheveux','Soin capillaire']},
];

// ============================================
// TECHNICIENS DATA
// ============================================
const TECHS = [
  {nm:'Mohammed Berrada',   ini:'MB',sp:'electricite',    rt:4.9,rv:234,pr:200,ph:'0661-234-567',av:true, c:'#f59e0b',bg:'rgba(245,158,11,.15)',tags:['Urgence','CertifiÃ© ONEE','Tableau']},
  {nm:'Fatima Zahra Alami', ini:'FZ',sp:'electricite',    rt:4.8,rv:178,pr:190,ph:'0662-345-678',av:true, c:'#f59e0b',bg:'rgba(245,158,11,.15)',tags:['RÃ©novation','LED','Domotique']},
  {nm:'Khalid Bensaid',     ini:'KB',sp:'electricite',    rt:4.7,rv:112,pr:180,ph:'0663-111-222',av:false,c:'#f59e0b',bg:'rgba(245,158,11,.15)',tags:['CÃ¢blage','Prises']},
  {nm:'Youssef El Idrissi', ini:'YE',sp:'plomberie',      rt:4.8,rv:187,pr:180,ph:'0663-456-789',av:true, c:'#3b82f6',bg:'rgba(59,130,246,.15)',tags:['Urgence','Fuite','DÃ©bouchage']},
  {nm:'Hamza Tazi',         ini:'HT',sp:'plomberie',      rt:4.7,rv:143,pr:160,ph:'0664-567-890',av:false,c:'#3b82f6',bg:'rgba(59,130,246,.15)',tags:['Chauffe-eau','Sanitaire']},
  {nm:'Mounir Rahali',      ini:'MR',sp:'plomberie',      rt:4.6,rv:89, pr:150,ph:'0661-888-777',av:true, c:'#3b82f6',bg:'rgba(59,130,246,.15)',tags:['RÃ©novation SDB']},
  {nm:'Yassine Ezher',      ini:'YZ',sp:'antenne',        rt:5.0,rv:312,pr:150,ph:'0719-089-944',av:true, c:'#a855f7',bg:'rgba(168,85,247,.15)',tags:['Parabole','TNT','Nilesat','LNB','IPTV'],isReal:true},
  {nm:'Karim Naciri',       ini:'KN',sp:'antenne',        rt:4.7,rv:156,pr:140,ph:'0665-678-901',av:true, c:'#a855f7',bg:'rgba(168,85,247,.15)',tags:['Antenne collective','DÃ©codeur']},
  {nm:'Said Bennani',       ini:'SB',sp:'telephone',      rt:4.9,rv:312,pr:120,ph:'0667-890-123',av:true, c:'#22c55e',bg:'rgba(34,197,94,.15)',tags:['iPhone','Samsung','Data Recovery']},
  {nm:'Anas El Ouafi',      ini:'AE',sp:'telephone',      rt:4.8,rv:201,pr:110,ph:'0668-901-234',av:true, c:'#22c55e',bg:'rgba(34,197,94,.15)',tags:['Android','Huawei','Xiaomi']},
  {nm:'Rachid Cherkaoui',   ini:'RC',sp:'climatisation',  rt:4.8,rv:143,pr:250,ph:'0669-012-345',av:true, c:'#06b6d4',bg:'rgba(6,182,212,.15)',tags:['Installation','Recharge gaz','Daikin']},
  {nm:'Hicham Zouheir',     ini:'HZ',sp:'machine-laver',  rt:4.7,rv:132,pr:170,ph:'0663-333-444',av:true, c:'#0ea5e9',bg:'rgba(14,165,233,.15)',tags:['Samsung','LG','Bosch']},
  {nm:'Nadia Moussaoui',    ini:'NM',sp:'peinture',       rt:4.9,rv:201,pr:160,ph:'0662-333-444',av:true, c:'#ec4899',bg:'rgba(236,72,153,.15)',tags:['DÃ©coration','Tadelakt','Enduit']},
  {nm:'Abderrahim Fassi',   ini:'AF',sp:'aluminium',      rt:4.8,rv:178,pr:130,ph:'0664-777-888',av:true, c:'#94a3b8',bg:'rgba(148,163,184,.15)',tags:['FenÃªtres','Double vitrage']},
  {nm:'Karima Chafik',      ini:'KC',sp:'nettoyage',      rt:4.8,rv:267,pr:100,ph:'0665-111-222',av:true, c:'#fbbf24',bg:'rgba(251,191,36,.15)',tags:['Vitres','Tapis','CanapÃ©']},
  {nm:'Driss El Amrani',    ini:'DE',sp:'surveillance',   rt:4.7,rv:98, pr:250,ph:'0666-222-333',av:true, c:'#dc2626',bg:'rgba(220,38,38,.15)',tags:['CamÃ©ras','Enregistreur']},
  {nm:'Hassan Jardin',      ini:'HJ',sp:'jardin',         rt:4.8,rv:145,pr:120,ph:'0667-333-444',av:true, c:'#16a34a',bg:'rgba(22,163,74,.15)',tags:['Tonte','Taille','Arrosage']},
  {nm:'Salma Coiffure',     ini:'SC',sp:'coiffure',       rt:4.9,rv:312,pr:150,ph:'0668-444-555',av:true, c:'#db2777',bg:'rgba(219,39,119,.15)',tags:['Coupe','Coloration','Brushing']},
];

// ============================================
// STATE
// ============================================
let userName = '', userRole = 'client', curSvc = null, curProb = null, curTech = null, selPay_ = 'online', city = 'Votre ville';
let pendingMission = null, pollInterval = null;
let logoClickCount = 0, logoClickTimer = null;

// ============================================
// CURSOR
// ============================================
const CUR = document.getElementById('cursor');
document.addEventListener('mousemove', e => { CUR.style.left = e.clientX + 'px'; CUR.style.top = e.clientY + 'px'; });
document.addEventListener('mouseover', e => { CUR.classList.toggle('big', !!e.target.closest('button,a,[onclick],.svc-tile,.prob-tile,.t-card,.pay-opt,.login-btn,.mission-card')); });

// ============================================
// LOGIN FUNCTIONS
// ============================================
function switchRole(role) {
  userRole = role;
  document.getElementById('role-client').classList.toggle('active', role === 'client');
  document.getElementById('role-tech').classList.toggle('active', role === 'tech');
  document.getElementById('client-login-fields').style.display = role === 'client' ? 'block' : 'none';
  document.getElementById('tech-login-fields').style.display = role === 'tech' ? 'block' : 'none';
}

function doLogin() {
  const err = document.getElementById('login-err');
  
  if (userRole === 'client') {
    const v = document.getElementById('login-input').value.trim();
    if (!v || v.length < 2) { err.textContent = 'Veuillez entrer un prÃ©nom valide.'; return; }
    userName = v.charAt(0).toUpperCase() + v.slice(1);
    localStorage.setItem('userName', userName);
    localStorage.setItem('userRole', 'client');
    loginSuccess();
  } else {
    const id = document.getElementById('tech-id').value.trim();
    const pass = document.getElementById('tech-pass').value.trim();
    if (TECH_ACCOUNTS[id] && TECH_ACCOUNTS[id] === pass) {
      userName = id;
      localStorage.setItem('userName', userName);
      localStorage.setItem('userRole', 'tech');
      loginSuccess();
    } else {
      err.textContent = 'Identifiant ou mot de passe incorrect.';
    }
  }
}

function loginSuccess() {
  document.getElementById('login-gate').style.opacity = '0';
  setTimeout(() => {
    document.getElementById('login-gate').style.display = 'none';
    document.getElementById('user-badge').style.display = 'flex';
    document.getElementById('user-badge-name').textContent = userName;
    
    if (userRole === 'tech') {
      document.getElementById('nav-tech-link').style.display = 'flex';
      updateTechNotif();
      showTechPanel();
    }
    
    // Load saved CallMeBot key
    const saved = localStorage.getItem('cmb_key');
    if (saved && document.getElementById('callmebot-key-inp')) {
      document.getElementById('callmebot-key-inp').value = saved;
    }
  }, 420);
}

// ============================================
// RECRUTEMENT
// ============================================
function showRecrutement() {
  document.getElementById('login-gate').style.display = 'none';
  showView('view-recrutement');
}

function updateFileName(input) {
  const name = input.files[0]?.name || 'Aucun fichier sÃ©lectionnÃ©';
  document.getElementById('cv-file-name').textContent = name;
}

async function submitCV() {
  const prenom = document.getElementById('cv-prenom').value.trim();
  const nom = document.getElementById('cv-nom').value.trim();
  const tel = document.getElementById('cv-tel').value.trim();
  const email = document.getElementById('cv-email').value.trim();
  const ville = document.getElementById('cv-ville').value.trim();
  const specialite = document.getElementById('cv-specialite').value;
  const exp = document.getElementById('cv-exp').value;
  const file = document.getElementById('cv-file').files[0];
  
  if (!prenom || !nom || !tel || !email || !ville || !file) {
    alert('Veuillez remplir tous les champs et joindre votre CV');
    return;
  }
  
  // Simuler l'envoi Ã  Discord (dans un vrai site, il faudrait uploader le fichier sur un serveur)
  const message = `ğŸ“„ **NOUVELLE CANDIDATURE TECHNICIEN**\n\n` +
    `**Nom complet :** ${prenom} ${nom}\n` +
    `**TÃ©lÃ©phone :** ${tel}\n` +
    `**Email :** ${email}\n` +
    `**Ville :** ${ville}\n` +
    `**SpÃ©cialitÃ© :** ${specialite}\n` +
    `**ExpÃ©rience :** ${exp} ans\n` +
    `**CV :** ${file.name} (${(file.size / 1024).toFixed(2)} Ko)`;
  
  try {
    await fetch(RECRUTEMENT_WEBHOOK, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        content: message,
        username: 'Mentech Recrutement'
      })
    });
    
    document.getElementById('cv-success').style.display = 'block';
    setTimeout(() => {
      document.getElementById('cv-success').style.display = 'none';
      goHome();
    }, 3000);
  } catch (e) {
    alert('Erreur lors de l\'envoi. Veuillez rÃ©essayer.');
  }
}

// ============================================
// LOCATION
// ============================================
function detectLoc() {
  document.getElementById('loc-txt').textContent = 'Localisation...';
  if (!navigator.geolocation) { setCity('Maroc'); return; }
  navigator.geolocation.getCurrentPosition(
    pos => fetch(`https://nominatim.openstreetmap.org/reverse?lat=${pos.coords.latitude}&lon=${pos.coords.longitude}&format=json&accept-language=fr`)
      .then(r => r.json()).then(d => { const a = d.address; setCity(a.city || a.town || a.village || a.suburb || a.county || 'Maroc'); })
      .catch(() => setCity('Ain Aouda')),
    () => setCity('Ain Aouda')
  );
}

function setCity(c) { city = c; document.getElementById('loc-txt').textContent = c; const r = document.getElementById('res-loc-txt'); if (r) r.textContent = c; }

// ============================================
// CALLMEBOT
// ============================================
function saveCallMeBotKey() {
  const k = document.getElementById('callmebot-key-inp').value.trim();
  if (!k) return;
  localStorage.setItem('cmb_key', k);
  document.getElementById('key-saved').style.display = 'inline-flex';
  setTimeout(() => document.getElementById('key-saved').style.display = 'none', 3000);
}

function getCallMeBotKey() { return localStorage.getItem('cmb_key') || ''; }

async function sendWhatsApp(message) {
  const key = getCallMeBotKey();
  if (!key) {
    const waMsg = encodeURIComponent(message);
    window.open(`https://wa.me/${TECH_PHONE_INTL}?text=${waMsg}`, '_blank');
    return false;
  }
  const encoded = encodeURIComponent(message);
  const url = `https://api.callmebot.com/whatsapp.php?phone=${TECH_PHONE_INTL}&text=${encoded}&apikey=${key}`;
  try { await fetch(url, { mode: 'no-cors' }); return true; } catch (e) { return false; }
}

// ============================================
// VIEWS
// ============================================
function showView(id) {
  document.querySelectorAll('.view,.view-flex').forEach(v => v.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

function goHome() { stopPoll(); showView('view-home'); }
function scrollSvc() { showView('view-home'); setTimeout(() => document.getElementById('services-anchor')?.scrollIntoView({ behavior: 'smooth' }), 100); }
function backToProbs() { if (curSvc) openSvc(curSvc.id); }

function showTechPanel() {
  document.getElementById('nav-tech-link').style.display = 'flex';
  document.getElementById('tech-panel-info').innerHTML = `${userName} Â· Antenne / Parabole`;
  const saved = getCallMeBotKey();
  if (saved && document.getElementById('callmebot-key-inp')) document.getElementById('callmebot-key-inp').value = saved;
  renderTechMissions();
  showView('view-tech');
}

function updateTechNotif() {
  const missions = getMissions().filter(m => m.status === 'waiting');
  const dot = document.getElementById('tech-notif-dot');
  if (missions.length > 0) dot.classList.add('active'); else dot.classList.remove('active');
}

// ============================================
// BUILD HOME
// ============================================
function buildGrid() {
  document.getElementById('svc-grid').innerHTML = SVCS.map(s => `
    <div class="svc-tile" onclick="openSvc('${s.id}')" style="--a:${s.a};--ab:${s.ab};">
      <div class="t-icon"><i class="fas ${s.icon}"></i></div>
      <div class="t-name">${s.name}</div>
      <div class="t-desc">${s.desc}</div>
      <div class="t-foot"><span class="t-count">${s.count} techniciens</span><i class="fas fa-arrow-right t-arr"></i></div>
    </div>`).join('');
}

function buildTicker() {
  const items = ['Ã‰lectricitÃ©','Plomberie','Antenne & Parabole','TÃ©lÃ©phone','Climatisation','RÃ©frigÃ©rateur','Machine Ã  laver','Peinture','Menuiserie','Aluminium','Nettoyage','Surveillance','Jardin','Coiffure','ğŸ“ 0719 089 944'];
  const all = [...items, ...items];
  document.getElementById('ticker').innerHTML = all.map(i => `<span class="tick-item"><span class="tick-dot"></span>${i}</span>`).join('');
}

// ============================================
// SERVICE FLOW
// ============================================
function openSvc(id) {
  curSvc = SVCS.find(s => s.id === id);
  document.getElementById('bc-svc').textContent = curSvc.name;
  document.getElementById('bc-svc2').textContent = curSvc.name;
  document.getElementById('svc-tag-lbl').innerHTML = `<i class="fas ${curSvc.icon}" style="color:${curSvc.a};"></i>&nbsp; ${curSvc.name}`;
  document.getElementById('prob-list').innerHTML = curSvc.probs.map(p => `
    <div class="prob-tile" onclick="openProb(this.dataset.p)" data-p="${p.replace(/"/g, '&quot;')}">
      <span class="p-name">${p}</span><i class="fas fa-arrow-right p-arr"></i>
    </div>`).join('');
  showView('view-problems');
}

function openProb(prob) {
  curProb = prob;
  document.getElementById('bc-prob').textContent = prob;
  let techs = TECHS.filter(t => t.sp === curSvc.id);
  if (techs.length < 2) techs = TECHS.slice(0, 5);
  techs = [...techs].sort((a, b) => (b.av - a.av) || (b.rt - a.rt));
  const dists = ['0.8 km','1.3 km','2.0 km','3.1 km','4.5 km','5.2 km'];
  const tagged = techs.map((t, i) => ({ ...t, dist: dists[i % dists.length] }));
  renderResults(tagged, `<strong>${tagged.length} technicien${tagged.length > 1 ? 's' : ''}</strong> pour &laquo;&nbsp;${prob}&nbsp;&raquo; â€” ${curSvc.name}`);
}

function allTechs() {
  curSvc = { id: 'all', name: 'Tous services', icon: 'fa-tools', a: '#E31837' }; curProb = 'Intervention gÃ©nÃ©rale';
  const all = [...TECHS].sort((a, b) => b.rt - a.rt);
  const dists = ['0.5','1.1','1.9','2.8','3.3','4.0','4.9','5.5','6.1','6.8','7.2','8.0','9.1','2.2','3.7','4.3','5.9','7.8','6.5','3.0','4.4','1.7','8.8','0.9','2.6','7.1','9.4'];
  renderResults(all.map((t, i) => ({ ...t, dist: dists[i % dists.length] + ' km' })), `<strong>${all.length} techniciens</strong> â€” toutes spÃ©cialitÃ©s`);
}

function renderResults(techs, meta) {
  document.getElementById('res-meta').innerHTML = meta;
  document.getElementById('res-loc-txt').textContent = city;
  document.getElementById('tech-grid').innerHTML = techs.map((t, i) => {
    const svc = SVCS.find(s => s.id === t.sp);
    return `
    <div class="t-card ${i === 0 ? 'top' : ''}">
      <div style="display:flex;align-items:center;gap:11px;">
        <div class="t-ava" style="background:${t.bg};color:${t.c};">${t.ini}</div>
        <div style="flex:1;">
          <div class="t-nm">${t.nm}${t.isReal ? '&nbsp;<span style="font-size:10px;background:var(--red);color:#fff;padding:2px 6px;font-family:\'Barlow Condensed\',sans-serif;font-weight:700;letter-spacing:.06em;">EXPERT</span>' : ''}</div>
          <div class="t-sp">${svc ? svc.name : t.sp}</div>
        </div>
        <div class="avdot ${t.av ? 'g' : 'y'}" title="${t.av ? 'Disponible' : 'OccupÃ©'}"></div>
      </div>
      <div style="display:flex;align-items:center;gap:5px;">
        <span style="color:#f59e0b;font-size:12px;">${'â˜…'.repeat(Math.floor(t.rt))}</span>
        <span style="font-family:'Anton',sans-serif;font-size:13px;">${t.rt}</span>
        <span style="font-size:11px;color:var(--gray);">(${t.rv} avis)</span>
      </div>
      <div style="display:flex;align-items:center;gap:5px;font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:12px;color:var(--gray);">
        <i class="fas fa-location-dot" style="color:var(--red);font-size:10px;"></i> ${t.dist} de ${city}
      </div>
      <div class="t-tags">${(t.tags || []).map(g => `<span class="t-tag">${g}</span>`).join('')}</div>
      <div class="t-price-row">
        <div class="t-price">${t.pr} MAD <span>/ heure</span></div>
        <button class="btn-hire" onclick="openModal(${TECHS.findIndex(x => x.nm === t.nm)})">Recruter</button>
      </div>
    </div>`;
  }).join('');
  showView('view-results');
}

// ============================================
// MODAL
// ============================================
function openModal(idx) {
  curTech = TECHS[idx] || TECHS[0];
  const svc = SVCS.find(s => s.id === curTech.sp);
  document.getElementById('m-tinfo').innerHTML = `
    <div class="m-ava" style="background:${curTech.bg};color:${curTech.c};">${curTech.ini}</div>
    <div>
      <div class="m-nm">${curTech.nm}</div>
      <div class="m-sub">${svc ? svc.name : ''} Â· â˜…${curTech.rt} (${curTech.rv} avis)</div>
      <div style="margin-top:3px;font-size:11px;color:var(--gray);">${curTech.ph}</div>
    </div>`;
  document.getElementById('m-mission-rows').innerHTML = `
    <div class="m-row"><span class="m-k">Client</span><span class="m-v" style="color:var(--white);">${userName}</span></div>
    <div class="m-row"><span class="m-k">Service</span><span class="m-v">${curSvc?.name || 'â€”'}</span></div>
    <div class="m-row"><span class="m-k">ProblÃ¨me</span><span class="m-v">${curProb || 'â€”'}</span></div>
    <div class="m-row"><span class="m-k">Localisation</span><span class="m-v">${city}</span></div>
    <div class="m-row"><span class="m-k">Tarif estimÃ©</span><span class="m-pv">${curTech.pr} MAD/h</span></div>`;
  ['client-phone','client-addr'].forEach(i => { document.getElementById(i).value = ''; document.getElementById(i).style.borderColor = ''; });
  document.getElementById('client-note').value = '';
  selPay('online');
  document.getElementById('overlay').classList.add('open');
}

function closeModal(e) { if (!e || e.target === document.getElementById('overlay')) document.getElementById('overlay').classList.remove('open'); }
function selPay(t) { selPay_ = t; document.querySelectorAll('.pay-opt').forEach(el => el.classList.remove('sel')); document.querySelectorAll('.pay-opt')[t === 'online' ? 0 : 1].classList.add('sel'); }

// ============================================
// LOADING
// ============================================
function runLoading(steps_config, onDone) {
  const screen = document.getElementById('loading-screen');
  const bar = document.getElementById('loading-bar');
  screen.classList.add('open');
  const stepEls = ['lstep-0','lstep-1','lstep-2','lstep-3'];
  const icons = ['fa-circle-notch','fa-satellite-dish','fa-whatsapp fab','fa-paper-plane'];
  stepEls.forEach((id, i) => {
    const el = document.getElementById(id);
    el.classList.remove('active','done');
    el.querySelector('.l-icon').innerHTML = icons[i].includes('fab') ? `<i class="fab ${icons[i].replace('fab ', '')}"></i>` : `<i class="fas ${icons[i]}"></i>`;
  });
  bar.style.transition = 'none'; bar.style.width = '0%';
  let idx = 0;
  const progs = [20, 50, 78, 100];
  function next() {
    if (idx >= stepEls.length) { setTimeout(() => { screen.classList.remove('open'); onDone(); }, 350); return; }
    if (idx > 0) { const p = document.getElementById(stepEls[idx - 1]); p.classList.remove('active'); p.classList.add('done'); p.querySelector('.l-icon').innerHTML = '<i class="fas fa-check"></i>'; }
    document.getElementById(stepEls[idx]).classList.add('active');
    bar.style.transition = 'width .4s ease'; bar.style.width = progs[idx] + '%';
    idx++;
    setTimeout(next, steps_config[idx - 1] || 900);
  }
  setTimeout(next, 80);
}

// ============================================
// CONFIRM BOOKING
// ============================================
async function doConfirm() {
  const phone = document.getElementById('client-phone').value.trim();
  const addr = document.getElementById('client-addr').value.trim();
  const note = document.getElementById('client-note').value.trim();
  let ok = true;
  if (!phone) { document.getElementById('client-phone').style.borderColor = 'var(--red)'; document.getElementById('client-phone').focus(); ok = false; }
  if (!addr) { document.getElementById('client-addr').style.borderColor = 'var(--red)'; if (ok) document.getElementById('client-addr').focus(); ok = false; }
  if (!ok) return;
  document.getElementById('overlay').classList.remove('open');

  const payLbl = selPay_ === 'online' ? 'Paiement en ligne (carte)' : 'Cash Ã  la livraison';
  const orderId = 'MT-' + Date.now().toString(36).toUpperCase().slice(-6);
  const now = new Date().toLocaleString('fr-FR', { dateStyle: 'short', timeStyle: 'short' });
  const svc = SVCS.find(s => s.id === curTech.sp);

  pendingMission = {
    orderId, userName, phone, addr, note,
    techName: curTech.nm, techPhone: curTech.ph, techIni: curTech.ini,
    techC: curTech.c, techBg: curTech.bg,
    service: curSvc?.name || 'â€”', problem: curProb || 'â€”',
    price: curTech.pr, payment: payLbl, city, now,
    status: 'waiting'
  };
  saveMission(pendingMission);

  runLoading([700, 900, 1000, 600], async () => {
    // Discord notification
    try {
      await fetch(DISCORD_WEBHOOK, {
        method: 'POST', headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          content: `ğŸ“¨ **Nouvelle mission** pour **${curTech.nm}** â€” de **${userName}** Â· ${curSvc?.name || ''} (${curProb}) Â· ${city} Â· En attente rÃ©ponse tech`,
          embeds: [{
            title: `ğŸ“¨ Nouvelle mission â€” En attente de confirmation tech`,
            color: 0xf59e0b,
            fields: [
              { name: 'ğŸªª NÂ° Mission', value: `\`${orderId}\``, inline: true },
              { name: 'â° Date', value: now, inline: true },
              { name: 'ğŸ‘¤ Client', value: userName, inline: true },
              { name: 'ğŸ“ TÃ©l. client', value: phone, inline: true },
              { name: 'ğŸ”§ Technicien', value: curTech.nm, inline: true },
              { name: 'ğŸ“± TÃ©l. tech', value: curTech.ph, inline: true },
              { name: 'ğŸ› ï¸ Service', value: curSvc?.name || 'â€”', inline: true },
              { name: 'ğŸ” ProblÃ¨me', value: curProb || 'â€”', inline: false },
              { name: 'ğŸ“ Adresse', value: `${city} â€” ${addr}`, inline: false },
              { name: 'ğŸ’° Prix', value: `${curTech.pr} MAD/h`, inline: true },
              { name: 'ğŸ’³ Paiement', value: payLbl, inline: true },
              { name: 'ğŸ“ Note', value: note || 'â€”', inline: false },
            ],
            footer: { text: `MENTECH â€” Le technicien doit rÃ©pondre OUI ou NON` }
          }]
        })
      });
    } catch (e) { }

    // WhatsApp message
    const waMsg = `ğŸ”” *MENTECH â€” Nouvelle mission* (%23${orderId})\n\nğŸ‘¤ Client : ${userName}\nğŸ“ TÃ©l : ${phone}\nğŸ› ï¸ Service : ${curSvc?.name || 'â€”'}\nğŸ” ProblÃ¨me : ${curProb}\nğŸ“ Adresse : ${addr}, ${city}\nğŸ’° Tarif : ${curTech.pr} MAD/h\nğŸ’³ Paiement : ${payLbl}\n${note ? 'ğŸ“ Note : ' + note + '\n' : ''}\nâœ… RÃ©pondez OUI pour accepter\nâŒ RÃ©pondez NON pour refuser\n\nâ€” MENTECH Platform`;
    const waSent = await sendWhatsApp(waMsg);

    buildWaitingScreen(orderId, waSent, payLbl, now);
    showView('view-waiting');
    startPoll(orderId);
  });
}

function buildWaitingScreen(orderId, waSent, payLbl, now) {
  const hasKey = !!getCallMeBotKey();
  const waNote = hasKey
    ? `<div class="wa-sent-note"><i class="fab fa-whatsapp"></i>Message WhatsApp envoyÃ© Ã  ${TECH_NAME_REAL} (${TECH_PHONE_DISPLAY})</div>`
    : `<div class="wa-sent-note"><i class="fab fa-whatsapp" style="color:#25D366;"></i>WhatsApp ouvert â€” envoyez le message Ã  ${TECH_NAME_REAL} (${TECH_PHONE_DISPLAY})<br><small style="color:#444;margin-top:3px;display:block;font-size:10px;">Pour automatiser : activez CallMeBot dans le Panel Tech</small></div>`;

  document.getElementById('view-waiting').innerHTML = `
    <div class="waiting-ring">
      <div class="waiting-pulse"></div>
      <div class="waiting-ring-inner"><i class="fas fa-satellite-dish"></i></div>
    </div>
    <div class="waiting-title">EN ATTENTE...</div>
    <p class="waiting-sub" id="waiting-sub">En attente de rÃ©ponse de <strong>${curTech.nm}</strong></p>
    ${waNote}
    <div class="waiting-card">
      <div class="wc-header"><span class="wc-title">Mission</span><span class="wc-id">${orderId}</span></div>
      <div class="wc-tech">
        <div class="wc-ava" style="background:${curTech.bg};color:${curTech.c};">${curTech.ini}</div>
        <div>
          <div class="wc-nm">${curTech.nm}</div>
          <div class="wc-sp">${curSvc?.name || 'â€”'} Â· â˜…${curTech.rt}</div>
        </div>
      </div>
      <div class="wc-rows">
        <div class="wc-row"><span class="wc-k">Client</span><span class="wc-v">${userName}</span></div>
        <div class="wc-row"><span class="wc-k">ProblÃ¨me</span><span class="wc-v">${curProb}</span></div>
        <div class="wc-row"><span class="wc-k">Adresse</span><span class="wc-v">${document.getElementById('client-addr')?.value || city}</span></div>
        <div class="wc-row"><span class="wc-k">Prix</span><span class="wc-v" style="color:var(--red);font-family:'Anton',sans-serif;font-size:16px;">${curTech.pr} MAD/h</span></div>
        <div class="wc-row"><span class="wc-k">Paiement</span><span class="wc-v">${payLbl}</span></div>
      </div>
      <div class="wc-status waiting" id="wc-status-bar">
        <span class="status-dot-w"></span>
        <span class="status-txt" id="wc-status-txt" style="color:var(--yellow);">En attente de rÃ©ponse du technicien...</span>
      </div>
    </div>
    <div style="display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin-top:4px;">
      <button class="btn-o" onclick="goHome()" style="font-size:11px;padding:9px 18px;">Retour Ã  l'accueil</button>
      ${userRole === 'tech' ? `<button class="btn-o" style="font-size:11px;padding:9px 18px;border-color:#a855f7;color:#a855f7;" onclick="showTechPanel()"><i class="fas fa-toolbox" style="font-size:10px;margin-right:5px;"></i>Ouvrir Panel Tech</button>` : ''}
    </div>`;
}

// ============================================
// POLLING
// ============================================
function startPoll(orderId) {
  stopPoll();
  pollInterval = setInterval(() => {
    const missions = getMissions();
    const m = missions.find(x => x.orderId === orderId);
    if (!m) return;
    if (m.status === 'accepted') { stopPoll(); onTechAccepted(m); }
    else if (m.status === 'declined') { stopPoll(); onTechDeclined(m); }
  }, 2000);
}

function stopPoll() { if (pollInterval) clearInterval(pollInterval); pollInterval = null; }

// ============================================
// TECH RESPONSE
// ============================================
async function onTechAccepted(m) {
  const now = new Date().toLocaleString('fr-FR', { dateStyle: 'short', timeStyle: 'short' });

  try {
    await fetch(DISCORD_WEBHOOK, {
      method: 'POST', headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        content: `âœ… **${m.techName}** a **ACCEPTÃ‰** la mission *${m.orderId}* de **${m.userName}** â€” ${m.service} (${m.problem}) â€” ${m.city}`,
        embeds: [{
          title: `âœ… Mission ACCEPTÃ‰E â€” MENTECH`,
          color: 0x22c55e,
          fields: [
            { name: 'ğŸªª Mission', value: `\`${m.orderId}\``, inline: true },
            { name: 'âœ… AcceptÃ© Ã ', value: now, inline: true },
            { name: 'ğŸ‘¤ Client', value: m.userName, inline: true },
            { name: 'ğŸ“ Client tÃ©l.', value: m.phone, inline: true },
            { name: 'ğŸ”§ Technicien', value: m.techName, inline: true },
            { name: 'ğŸ“± Tech tÃ©l.', value: m.techPhone, inline: true },
            { name: 'ğŸ› ï¸ Service', value: m.service, inline: true },
            { name: 'ğŸ” ProblÃ¨me', value: m.problem, inline: false },
            { name: 'ğŸ“ Adresse', value: `${m.city} â€” ${m.addr}`, inline: false },
            { name: 'ğŸ’° Prix', value: `${m.price} MAD/h`, inline: true },
            { name: 'ğŸ’³ Paiement', value: m.payment, inline: true },
          ],
          footer: { text: 'MENTECH â€” Mission en route !' }
        }]
      })
    });
  } catch (e) { }

  buildFinalScreen(m, now);
  showView('view-final');
}

function buildFinalScreen(m, now) {
  const tech = TECHS.find(t => t.nm === m.techName) || { ini: '?', c: '#888', bg: '#222', rt: 5, rv: 0, ph: '', tags: [] };
  document.getElementById('view-final').innerHTML = `
    <div class="final-badge"><span class="pulse-dot"></span> Technicien a acceptÃ©</div>
    <div class="final-check"><i class="fas fa-check"></i></div>
    <h1>MISSION<br>CONFIRMÃ‰E.</h1>
    <p class="final-sub">${m.techName} est en route pour votre intervention.</p>

    <div class="final-card">
      <div class="fc-header">
        <span class="fc-title">RÃ©capitulatif complet</span>
        <span class="fc-id">${m.orderId}</span>
      </div>
      <div class="fc-tech">
        <div class="fc-ava" style="background:${tech.bg};color:${tech.c};">${tech.ini}</div>
        <div>
          <div class="fc-nm">${m.techName}</div>
          <div class="fc-sub">â˜…${tech.rt} Â· ${tech.rv} avis Â· ${m.service}</div>
          <div style="margin-top:6px;">${(tech.tags || []).map(g => `<span style="font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:10px;letter-spacing:.05em;text-transform:uppercase;padding:2px 7px;border:1px solid #2a2a2a;color:#555;margin-right:4px;">${g}</span>`).join('')}</div>
        </div>
        <div class="fc-price-right">
          <div class="fc-price">${m.price} MAD</div>
          <div class="fc-pricelab">/ heure</div>
        </div>
      </div>
      <div class="fc-rows">
        <div class="fc-row"><span class="fck">Client</span><span class="fcv" style="color:var(--white);font-size:15px;">${m.userName}</span></div>
        <div class="fc-row"><span class="fck">TÃ©lÃ©phone client</span><span class="fcv">${m.phone}</span></div>
        <div class="fc-row"><span class="fck">Service</span><span class="fcv">${m.service}</span></div>
        <div class="fc-row"><span class="fck">ProblÃ¨me</span><span class="fcv">${m.problem}</span></div>
        <div class="fc-row"><span class="fck">Adresse</span><span class="fcv">${m.addr}</span></div>
        <div class="fc-row"><span class="fck">Localisation</span><span class="fcv">${m.city}</span></div>
        ${m.note ? `<div class="fc-row"><span class="fck">Note</span><span class="fcv">${m.note}</span></div>` : ''}
        <div class="fc-row"><span class="fck">Paiement</span><span class="fcv">${m.payment}</span></div>
        <div class="fc-row"><span class="fck">Tarif</span><span class="fcv red" style="font-family:'Anton',sans-serif;font-size:18px;">${m.price} MAD / h</span></div>
        <div class="fc-row"><span class="fck">Date</span><span class="fcv">${m.now}</span></div>
        <div class="fc-row"><span class="fck">AcceptÃ© Ã </span><span class="fcv green">${now}</span></div>
      </div>
      <div class="fc-accepted-bar">
        <span class="fc-accepted-dot"></span>
        <span class="fc-accepted-txt">âœ… ${m.techName} a acceptÃ© â€” En route pour votre adresse</span>
      </div>
    </div>

    <div class="d-note-bar">
      <i class="fab fa-discord"></i>
      <span>Confirmation envoyÃ©e sur Discord Â· </span>
      <i class="fab fa-whatsapp"></i>
      <span><strong>${m.userName} confirmÃ© avec ${m.techName}</strong></span>
    </div>
    <button class="btn-r" style="padding:13px 32px;font-family:'Anton',sans-serif;font-size:15px;" onclick="goHome()">â† Retour Ã  l'accueil</button>`;
}

function onTechDeclined(m) {
  const statusBar = document.getElementById('wc-status-bar');
  const statusTxt = document.getElementById('wc-status-txt');
  const waitingSub = document.getElementById('waiting-sub');
  if (statusBar) {
    statusBar.className = 'wc-status declined';
    statusBar.querySelector('.status-dot-w').className = 'status-dot-r';
    statusTxt.style.color = '#ef4444';
    statusTxt.textContent = `${m.techName} a refusÃ© la mission â€” Choisissez un autre technicien`;
  }
  if (waitingSub) waitingSub.innerHTML = `<strong style="color:#ef4444;">${m.techName} a refusÃ©.</strong> Veuillez choisir un autre technicien.`;

  setTimeout(() => {
    const container = document.getElementById('view-waiting');
    const declined = document.createElement('div');
    declined.innerHTML = `
      <div class="declined-box">
        <div class="declined-icon"><i class="fas fa-times-circle"></i></div>
        <div class="declined-title">TECHNICIEN INDISPONIBLE</div>
        <div class="declined-sub">${m.techName} ne peut pas prendre cette mission pour le moment.</div>
        <div style="display:flex;gap:10px;justify-content:center;flex-wrap:wrap;">
          <button class="btn-r" onclick="backToProbs()"><i class="fas fa-redo" style="font-size:11px;"></i> Choisir un autre technicien</button>
          <button class="btn-o" style="font-size:11px;padding:11px 18px;" onclick="goHome()">Retour accueil</button>
        </div>
      </div>`;
    const navBtns = container.querySelector('[style*="display:flex;gap:10px"]');
    if (navBtns) container.insertBefore(declined.firstElementChild, navBtns);
    else container.appendChild(declined.firstElementChild);

    fetch(DISCORD_WEBHOOK, {
      method: 'POST', headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        content: `âŒ **${m.techName}** a **REFUSÃ‰** la mission \`${m.orderId}\` de **${m.userName}** â€” Le client cherche un autre technicien.`,
      })
    }).catch(() => { });
  }, 500);
}

// ============================================
// TECH PANEL MISSION MANAGEMENT
// ============================================
function saveMission(mission) {
  let missions = getMissions();
  const idx = missions.findIndex(m => m.orderId === mission.orderId);
  if (idx >= 0) missions[idx] = mission; else missions.push(mission);
  localStorage.setItem('mentech_missions', JSON.stringify(missions));
  updateTechNotif();
}

function getMissions() {
  try { return JSON.parse(localStorage.getItem('mentech_missions')) || []; } catch (e) { return []; }
}

function updateMissionStatus(orderId, status) {
  let missions = getMissions();
  const m = missions.find(x => x.orderId === orderId);
  if (m) { m.status = status; localStorage.setItem('mentech_missions', JSON.stringify(missions)); updateTechNotif(); }
}

function techRespond(orderId, status) {
  updateMissionStatus(orderId, status);
  renderTechMissions();

  const m = getMissions().find(x => x.orderId === orderId);
  if (m && status === 'accepted') {
    sendWhatsApp(`âœ… *MENTECH â€” Mission acceptÃ©e* (%23${orderId})\n\nVous avez acceptÃ© la mission de *${m.userName}*.\nğŸ“ TÃ©l client : ${m.phone}\nğŸ“ Adresse : ${m.addr}, ${m.city}\nğŸ” ${m.problem}\nğŸ’° ${m.price} MAD/h\n\nğŸš— Rendez-vous dÃ¨s que possible !`);
  }
}

function renderTechMissions() {
  const missions = getMissions().filter(m => m.status === 'waiting' || m.status === 'accepted' || m.status === 'declined');
  const list = document.getElementById('tech-mission-list');
  if (!list) return;
  if (missions.length === 0) {
    list.innerHTML = `<div class="tp-empty"><i class="fas fa-inbox"></i><p>Aucune mission en attente pour le moment.</p></div>`;
    return;
  }
  list.innerHTML = missions.slice().reverse().map(m => {
    const isPending = m.status === 'waiting';
    const isAccepted = m.status === 'accepted';
    const statusColor = isPending ? 'var(--yellow)' : isAccepted ? 'var(--green)' : '#ef4444';
    const statusText = isPending ? 'En attente' : isAccepted ? 'âœ… AcceptÃ©e' : 'âŒ RefusÃ©e';
    return `
    <div class="mission-card">
      <div class="mc-header">
        <span class="mc-order">${m.orderId}</span>
        <div style="display:flex;align-items:center;gap:8px;">
          <span style="font-family:'Barlow Condensed',sans-serif;font-weight:700;font-size:11px;color:${statusColor};letter-spacing:.06em;">${statusText}</span>
          <span class="mc-time">${m.now}</span>
        </div>
      </div>
      <div class="mc-client">
        <div class="mc-client-icon"><i class="fas fa-user"></i></div>
        <div>
          <div class="mc-client-nm">${m.userName}</div>
          <div class="mc-client-ph">${m.phone}</div>
        </div>
      </div>
      <div class="mc-rows">
        <div class="mc-row"><span class="mc-k">Service</span><span class="mc-v">${m.service}</span></div>
        <div class="mc-row"><span class="mc-k">ProblÃ¨me</span><span class="mc-v">${m.problem}</span></div>
        <div class="mc-row"><span class="mc-k">Adresse</span><span class="mc-v">${m.addr}, ${m.city}</span></div>
        ${m.note ? `<div class="mc-row"><span class="mc-k">Note client</span><span class="mc-v">${m.note}</span></div>` : ''}
        <div class="mc-row"><span class="mc-k">Paiement</span><span class="mc-v">${m.payment}</span></div>
        <div class="mc-row"><span class="mc-k">Tarif</span><span class="mc-v"><span class="mc-price">${m.price} MAD/h</span></span></div>
      </div>
      <div class="mc-actions">
        ${isPending ? `
          <button class="btn-g" onclick="techRespond('${m.orderId}','accepted')">
            <i class="fas fa-check"></i> OUI â€” J'accepte
          </button>
          <button class="btn-danger" onclick="techRespond('${m.orderId}','declined')">
            <i class="fas fa-times"></i> NON â€” Refuser
          </button>
        ` : isAccepted ? `
          <div class="mc-done"><i class="fas fa-check-circle"></i> Vous avez acceptÃ© cette mission</div>
        ` : `
          <div class="mc-done" style="background:rgba(239,68,68,.08);border-color:rgba(239,68,68,.2);color:#ef4444;"><i class="fas fa-times-circle"></i> Vous avez refusÃ© cette mission</div>
        `}
      </div>
    </div>`;
  }).join('');
}

// ============================================
// INIT
// ============================================
buildGrid();
buildTicker();
detectLoc();

// Check if already logged in
const savedName = localStorage.getItem('userName');
const savedRole = localStorage.getItem('userRole');
if (savedName && savedRole) {
  userName = savedName;
  userRole = savedRole;
  document.getElementById('login-gate').style.display = 'none';
  document.getElementById('user-badge').style.display = 'flex';
  document.getElementById('user-badge-name').textContent = userName;
  if (userRole === 'tech') {
    document.getElementById('nav-tech-link').style.display = 'flex';
    updateTechNotif();
  }
}

// Logo click handler
function handleLogoClick() {
  logoClickCount++;
  clearTimeout(logoClickTimer);
  logoClickTimer = setTimeout(() => logoClickCount = 0, 1500);
  if (logoClickCount >= 5) { logoClickCount = 0; showTechPanel(); }
}

// Keyboard T E C H
let techSeq = '';
document.addEventListener('keydown', e => {
  techSeq = (techSeq + e.key.toLowerCase()).slice(-4);
  if (techSeq === 'tech') showTechPanel();
});

// Load saved CallMeBot key
const savedKey = getCallMeBotKey();
if (savedKey && document.getElementById('callmebot-key-inp')) {
  document.getElementById('callmebot-key-inp').value = savedKey;
}
</script>
</body>
</html>